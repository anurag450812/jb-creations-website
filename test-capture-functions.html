<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Capture Functions</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-results {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .result-item {
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        .result-item img {
            max-width: 200px;
            max-height: 200px;
            border: 1px solid #000;
        }
        button {
            background: #16697A;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0f5a6a;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>Capture Functions Test</h1>
    <p>This page tests the <code>captureFramePreview</code> and <code>captureFramedImage</code> functions from script.js</p>

    <div class="test-section">
        <h2>1. Function Availability Test</h2>
        <button onclick="testFunctionAvailability()">Test Function Availability</button>
        <div id="availabilityResults"></div>
    </div>

    <div class="test-section">
        <h2>2. Load Test Image</h2>
        <input type="file" id="testImageUpload" accept="image/*" onchange="loadTestImage(this)">
        <button onclick="loadSampleImage()">Load Sample Image (base64)</button>
        <div id="imageLoadResults"></div>
    </div>

    <div class="test-section">
        <h2>3. Test Capture Functions</h2>
        <button onclick="testCaptureFramedImage()" id="testFramedBtn">Test captureFramedImage()</button>
        <button onclick="testCaptureFramePreview()" id="testPreviewBtn">Test captureFramePreview()</button>
        <button onclick="testBothFunctions()" id="testBothBtn">Test Both Functions</button>
        <div id="captureResults"></div>
    </div>

    <div class="test-section">
        <h2>4. Performance Test</h2>
        <button onclick="performanceTest()">Run Performance Test</button>
        <div id="performanceResults"></div>
    </div>

    <script>
        // Import the state and functions from script.js if available
        let scriptLoaded = false;
        
        // Check if script.js functions are available
        function testFunctionAvailability() {
            const results = document.getElementById('availabilityResults');
            let html = '<div class="status info">Testing function availability...</div>';
            
            const tests = [
                { name: 'captureFramedImage', exists: typeof window.captureFramedImage === 'function' || typeof captureFramedImage === 'function' },
                { name: 'captureFramePreview', exists: typeof window.captureFramePreview === 'function' || typeof captureFramePreview === 'function' },
                { name: 'state object', exists: typeof window.state === 'object' || typeof state === 'object' },
                { name: 'getCanvasImageData', exists: typeof window.getCanvasImageData === 'function' || typeof getCanvasImageData === 'function' }
            ];
            
            html += '<h3>Function Availability Results:</h3>';
            tests.forEach(test => {
                const status = test.exists ? 'success' : 'error';
                const icon = test.exists ? '‚úÖ' : '‚ùå';
                html += `<div class="status ${status}">${icon} ${test.name}: ${test.exists ? 'Available' : 'Not Available'}</div>`;
            });
            
            scriptLoaded = tests.every(test => test.exists);
            
            if (!scriptLoaded) {
                html += '<div class="status error">‚ö†Ô∏è script.js not fully loaded. Some tests may not work.</div>';
                html += '<div class="status info">To run full tests, include this page in the main website or load script.js</div>';
            }
            
            results.innerHTML = html;
        }
        
        // Load a test image
        function loadTestImage(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = e.target.result;
                    // Set up test state if possible
                    if (typeof state !== 'undefined') {
                        state.image = imageData;
                        state.frameSize = { size: '13x19', orientation: 'portrait' };
                        state.frameColor = '#8B4513';
                        state.adjustments = {
                            brightness: 100,
                            contrast: 100,
                            highlights: 100,
                            shadows: 100,
                            vibrance: 100
                        };
                    }
                    
                    document.getElementById('imageLoadResults').innerHTML = 
                        '<div class="status success">‚úÖ Test image loaded successfully</div>' +
                        `<img src="${imageData}" style="max-width: 200px; margin: 10px 0;">`;
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Load a sample base64 image
        function loadSampleImage() {
            // Create a simple test image (1x1 pixel red image)
            const canvas = document.createElement('canvas');
            canvas.width = 100;
            canvas.height = 100;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(0, 0, 100, 100);
            ctx.fillStyle = '#00ff00';
            ctx.fillRect(25, 25, 50, 50);
            
            const imageData = canvas.toDataURL('image/png');
            
            // Set up test state if possible
            if (typeof state !== 'undefined') {
                state.image = imageData;
                state.frameSize = { size: '13x19', orientation: 'portrait' };
                state.frameColor = '#8B4513';
                state.adjustments = {
                    brightness: 100,
                    contrast: 100,
                    highlights: 100,
                    shadows: 100,
                    vibrance: 100
                };
            }
            
            document.getElementById('imageLoadResults').innerHTML = 
                '<div class="status success">‚úÖ Sample test image created and loaded</div>' +
                `<img src="${imageData}" style="max-width: 200px; margin: 10px 0;">`;
        }
        
        // Test captureFramedImage function
        async function testCaptureFramedImage() {
            const btn = document.getElementById('testFramedBtn');
            const results = document.getElementById('captureResults');
            
            btn.disabled = true;
            btn.textContent = 'Testing...';
            
            try {
                if (typeof captureFramedImage === 'function') {
                    const startTime = Date.now();
                    const result = await captureFramedImage();
                    const endTime = Date.now();
                    
                    let html = '<h3>captureFramedImage Results:</h3>';
                    if (result) {
                        html += '<div class="status success">‚úÖ Function executed successfully</div>';
                        html += `<div class="status info">‚è±Ô∏è Execution time: ${endTime - startTime}ms</div>`;
                        html += `<div class="status info">üìä Result size: ${result.length} characters</div>`;
                        html += '<div class="result-item"><h4>Captured Image (Print Quality)</h4><img src="' + result + '"></div>';
                    } else {
                        html += '<div class="status error">‚ùå Function returned null/undefined</div>';
                    }
                    
                    results.innerHTML = html;
                } else {
                    results.innerHTML = '<div class="status error">‚ùå captureFramedImage function not available</div>';
                }
            } catch (error) {
                results.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
                console.error('captureFramedImage test error:', error);
            }
            
            btn.disabled = false;
            btn.textContent = 'Test captureFramedImage()';
        }
        
        // Test captureFramePreview function
        async function testCaptureFramePreview() {
            const btn = document.getElementById('testPreviewBtn');
            const results = document.getElementById('captureResults');
            
            btn.disabled = true;
            btn.textContent = 'Testing...';
            
            try {
                if (typeof captureFramePreview === 'function') {
                    const startTime = Date.now();
                    const result = await captureFramePreview();
                    const endTime = Date.now();
                    
                    let html = '<h3>captureFramePreview Results:</h3>';
                    if (result) {
                        html += '<div class="status success">‚úÖ Function executed successfully</div>';
                        html += `<div class="status info">‚è±Ô∏è Execution time: ${endTime - startTime}ms</div>`;
                        html += `<div class="status info">üìä Result size: ${result.length} characters</div>`;
                        html += '<div class="result-item"><h4>Captured Preview (with Frame)</h4><img src="' + result + '"></div>';
                    } else {
                        html += '<div class="status error">‚ùå Function returned null/undefined</div>';
                    }
                    
                    results.innerHTML = html;
                } else {
                    results.innerHTML = '<div class="status error">‚ùå captureFramePreview function not available</div>';
                }
            } catch (error) {
                results.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
                console.error('captureFramePreview test error:', error);
            }
            
            btn.disabled = false;
            btn.textContent = 'Test captureFramePreview()';
        }
        
        // Test both functions
        async function testBothFunctions() {
            const btn = document.getElementById('testBothBtn');
            const results = document.getElementById('captureResults');
            
            btn.disabled = true;
            btn.textContent = 'Testing both...';
            
            try {
                const startTime = Date.now();
                const [framedResult, previewResult] = await Promise.all([
                    typeof captureFramedImage === 'function' ? captureFramedImage() : Promise.resolve(null),
                    typeof captureFramePreview === 'function' ? captureFramePreview() : Promise.resolve(null)
                ]);
                const endTime = Date.now();
                
                let html = '<h3>Both Functions Test Results:</h3>';
                html += `<div class="status info">‚è±Ô∏è Total execution time: ${endTime - startTime}ms</div>`;
                
                html += '<div class="test-results">';
                if (framedResult) {
                    html += '<div class="result-item"><h4>captureFramedImage Result</h4><img src="' + framedResult + '"><p>Size: ' + framedResult.length + ' chars</p></div>';
                }
                if (previewResult) {
                    html += '<div class="result-item"><h4>captureFramePreview Result</h4><img src="' + previewResult + '"><p>Size: ' + previewResult.length + ' chars</p></div>';
                }
                html += '</div>';
                
                const successCount = (framedResult ? 1 : 0) + (previewResult ? 1 : 0);
                if (successCount === 2) {
                    html += '<div class="status success">‚úÖ Both functions executed successfully</div>';
                } else {
                    html += `<div class="status error">‚ùå Only ${successCount}/2 functions succeeded</div>`;
                }
                
                results.innerHTML = html;
            } catch (error) {
                results.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
                console.error('Both functions test error:', error);
            }
            
            btn.disabled = false;
            btn.textContent = 'Test Both Functions';
        }
        
        // Performance test
        async function performanceTest() {
            const results = document.getElementById('performanceResults');
            results.innerHTML = '<div class="status info">Running performance test...</div>';
            
            try {
                const iterations = 5;
                const framedTimes = [];
                const previewTimes = [];
                
                for (let i = 0; i < iterations; i++) {
                    // Test captureFramedImage
                    if (typeof captureFramedImage === 'function') {
                        const start = Date.now();
                        await captureFramedImage();
                        framedTimes.push(Date.now() - start);
                    }
                    
                    // Test captureFramePreview
                    if (typeof captureFramePreview === 'function') {
                        const start = Date.now();
                        await captureFramePreview();
                        previewTimes.push(Date.now() - start);
                    }
                }
                
                const avgFramed = framedTimes.reduce((a, b) => a + b, 0) / framedTimes.length;
                const avgPreview = previewTimes.reduce((a, b) => a + b, 0) / previewTimes.length;
                
                let html = '<h3>Performance Test Results:</h3>';
                html += `<div class="status info">üìä Iterations: ${iterations}</div>`;
                html += `<div class="status info">‚è±Ô∏è captureFramedImage average: ${avgFramed.toFixed(2)}ms</div>`;
                html += `<div class="status info">‚è±Ô∏è captureFramePreview average: ${avgPreview.toFixed(2)}ms</div>`;
                
                results.innerHTML = html;
            } catch (error) {
                results.innerHTML = `<div class="status error">‚ùå Performance test error: ${error.message}</div>`;
            }
        }
        
        // Auto-run availability test on load
        window.onload = function() {
            testFunctionAvailability();
        };
    </script>
</body>
</html>
