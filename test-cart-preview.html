<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Preview Test - JB Creations</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #16697A;
            text-align: center;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .cart-item-preview {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            margin: 10px 0;
            background: #f9f9f9;
        }
        .cart-item-image {
            width: 100px;
            height: 100px;
            border: 2px solid #8B4513;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 5px;
        }
        .cart-item-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .cart-item-details {
            flex: 1;
        }
        .cart-item-title {
            font-weight: bold;
            color: #16697A;
            margin: 0 0 5px 0;
        }
        .cart-item-specs {
            color: #666;
            font-size: 14px;
        }
        .cart-item-price {
            font-weight: bold;
            color: #27ae60;
            font-size: 18px;
        }
        button {
            background: #16697A;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #134e5a;
        }
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .info {
            color: #16697A;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cart Preview Feature Test</h1>
        
        <div class="test-section">
            <h3>Test 1: Check Cart Data Structure</h3>
            <button onclick="checkCartData()">Check Current Cart</button>
            <div id="cartDataResult"></div>
        </div>
        
        <div class="test-section">
            <h3>Test 2: Create Test Cart Item</h3>
            <button onclick="createTestCartItem()">Create Test Item with Preview</button>
            <div id="createTestResult"></div>
        </div>
        
        <div class="test-section">
            <h3>Test 2.5: Test Live Preview Capture</h3>
            <button onclick="testLivePreviewCapture()">Test Live Preview Capture</button>
            <div id="livePreviewResult"></div>
        </div>
        
        <div class="test-section">
            <h3>Test 3: Preview Cart Items</h3>
            <button onclick="previewCartItems()">Preview Cart Items</button>
            <div id="cartPreviewContainer"></div>
        </div>
        
        <div class="test-section">
            <h3>Test 4: Compare Image Types</h3>
            <button onclick="compareImageTypes()">Compare Print vs Preview Images</button>
            <div id="comparisonResult"></div>
        </div>
        
        <div class="test-section">
            <h3>Actions</h3>
            <button onclick="clearCart()">Clear Cart</button>
            <button onclick="goToMainSite()">Go to Main Site</button>
            <button onclick="goToCart()">Go to Cart Page</button>
        </div>
    </div>

    <script>
        function checkCartData() {
            const cart = JSON.parse(localStorage.getItem('photoFramingCart') || '[]');
            const result = document.getElementById('cartDataResult');
            
            if (cart.length === 0) {
                result.innerHTML = '<p class="info">Cart is empty. Add some items first.</p>';
                return;
            }
            
            result.innerHTML = `
                <p class="success">Found ${cart.length} items in cart</p>
                <div style="max-height: 300px; overflow-y: auto; background: #f8f8f8; padding: 10px; border-radius: 5px;">
                    <pre>${JSON.stringify(cart, null, 2)}</pre>
                </div>
            `;
            
            // Check if items have preview images
            cart.forEach((item, index) => {
                const hasPreview = !!item.previewImage;
                const hasPrint = !!item.printImage;
                const hasDisplay = !!item.displayImage;
                
                console.log(`Item ${index}:`, {
                    hasPreviewImage: hasPreview,
                    hasPrintImage: hasPrint,
                    hasDisplayImage: hasDisplay,
                    previewImageSize: item.previewImage ? item.previewImage.length : 0,
                    printImageSize: item.printImage ? item.printImage.length : 0
                });
            });
        }
        
        function createTestCartItem() {
            // Create a simple colored canvas as test image
            const canvas = document.createElement('canvas');
            canvas.width = 200;
            canvas.height = 200;
            const ctx = canvas.getContext('2d');
            
            // Draw test print image (just the photo)
            ctx.fillStyle = '#4CAF50';
            ctx.fillRect(0, 0, 200, 200);
            ctx.fillStyle = 'white';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('PRINT IMAGE', 100, 100);
            ctx.fillText('(Cropped Photo)', 100, 120);
            const printImage = canvas.toDataURL('image/png');
            
            // Draw test preview image (with frame)
            canvas.width = 240;
            canvas.height = 240;
            ctx.fillStyle = '#8B4513'; // Frame color
            ctx.fillRect(0, 0, 240, 240);
            ctx.fillStyle = '#4CAF50'; // Image area
            ctx.fillRect(20, 20, 200, 200);
            ctx.fillStyle = 'white';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('PREVIEW IMAGE', 120, 115);
            ctx.fillText('(With Frame)', 120, 135);
            const previewImage = canvas.toDataURL('image/png');
            
            const testItem = {
                id: Date.now(),
                printImage: printImage,
                previewImage: previewImage,
                frameSize: { size: '13x19', orientation: 'portrait' },
                frameColor: '#8B4513',
                frameTexture: 'wood',
                adjustments: {
                    brightness: 100,
                    contrast: 100,
                    highlights: 100,
                    shadows: 100,
                    vibrance: 100
                },
                zoom: 1,
                position: { x: 0, y: 0 },
                price: 349,
                timestamp: new Date().toISOString()
            };
            
            // Add to cart
            let cart = JSON.parse(localStorage.getItem('photoFramingCart') || '[]');
            cart.push(testItem);
            localStorage.setItem('photoFramingCart', JSON.stringify(cart));
            
            document.getElementById('createTestResult').innerHTML = `
                <p class="success">Test item created and added to cart!</p>
                <p class="info">Print image size: ${printImage.length} characters</p>
                <p class="info">Preview image size: ${previewImage.length} characters</p>
            `;
        }
        
        function previewCartItems() {
            const cart = JSON.parse(localStorage.getItem('photoFramingCart') || '[]');
            const container = document.getElementById('cartPreviewContainer');
            
            if (cart.length === 0) {
                container.innerHTML = '<p class="info">No items in cart to preview.</p>';
                return;
            }
            
            container.innerHTML = '<h4>Cart Items Preview:</h4>';
            
            cart.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'cart-item-preview';
                
                const imageToShow = item.previewImage || item.printImage || '';
                
                itemDiv.innerHTML = `
                    <div class="cart-item-image">
                        ${imageToShow ? 
                            `<img src="${imageToShow}" alt="Preview">` : 
                            '<span style="color: #999;">No Image</span>'
                        }
                    </div>
                    <div class="cart-item-details">
                        <div class="cart-item-title">Custom Photo Frame #${index + 1}</div>
                        <div class="cart-item-specs">
                            Size: ${item.frameSize ? item.frameSize.size : 'N/A'} |
                            Color: ${item.frameColor || 'N/A'} |
                            Texture: ${item.frameTexture || 'N/A'}
                        </div>
                        <div class="cart-item-specs">
                            Preview Image: ${item.previewImage ? '✅ Available' : '❌ Missing'} |
                            Print Image: ${item.printImage ? '✅ Available' : '❌ Missing'}
                        </div>
                    </div>
                    <div class="cart-item-price">₹${item.price || 0}</div>
                `;
                
                container.appendChild(itemDiv);
            });
        }
        
        function compareImageTypes() {
            const cart = JSON.parse(localStorage.getItem('photoFramingCart') || '[]');
            const result = document.getElementById('comparisonResult');
            
            if (cart.length === 0) {
                result.innerHTML = '<p class="info">No items in cart to compare.</p>';
                return;
            }
            
            result.innerHTML = '<h4>Image Type Comparison:</h4>';
            
            cart.forEach((item, index) => {
                const comparisonDiv = document.createElement('div');
                comparisonDiv.style.cssText = 'margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px;';
                
                comparisonDiv.innerHTML = `
                    <h5>Item ${index + 1}</h5>
                    <div style="display: flex; gap: 20px; align-items: center;">
                        <div style="text-align: center;">
                            <div style="font-weight: bold; margin-bottom: 5px;">Print Image</div>
                            <div style="width: 100px; height: 100px; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center;">
                                ${item.printImage ? 
                                    `<img src="${item.printImage}" style="max-width: 100%; max-height: 100%; object-fit: contain;">` : 
                                    '<span style="color: #999; font-size: 12px;">Missing</span>'
                                }
                            </div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                ${item.printImage ? 'For Printing' : 'Not Available'}
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <div style="font-weight: bold; margin-bottom: 5px;">Preview Image</div>
                            <div style="width: 100px; height: 100px; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center;">
                                ${item.previewImage ? 
                                    `<img src="${item.previewImage}" style="max-width: 100%; max-height: 100%; object-fit: contain;">` : 
                                    '<span style="color: #999; font-size: 12px;">Missing</span>'
                                }
                            </div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                ${item.previewImage ? 'For Cart Display' : 'Not Available'}
                            </div>
                        </div>
                        
                        <div style="flex: 1; padding-left: 20px;">
                            <div style="font-size: 14px;">
                                <strong>Differences:</strong><br>
                                • Print Image: Cropped photo without frame borders<br>
                                • Preview Image: Complete view with frame borders<br>
                                • Preview Image is what customers see in cart<br>
                                • Print Image is what gets sent for production
                            </div>
                        </div>
                    </div>
                `;
                
                result.appendChild(comparisonDiv);
            });
        }
        
        function clearCart() {
            localStorage.removeItem('photoFramingCart');
            alert('Cart cleared!');
            location.reload();
        }
        
        function goToMainSite() {
            window.location.href = './index.html';
        }
        
        function goToCart() {
            window.location.href = './cart.html';
        }
        
        function testLivePreviewCapture() {
            const result = document.getElementById('livePreviewResult');
            result.innerHTML = '<p class="info">Testing live preview capture... (this requires being on the customize page)</p>';
            
            // Check if we're on the right page
            if (!window.location.href.includes('test-cart-preview.html')) {
                result.innerHTML = '<p class="error">This test needs to be run from the customize page where the live preview exists.</p>';
                return;
            }
            
            // If the test function exists (from script.js), use it
            if (window.testFrameCapture) {
                window.testFrameCapture().then(previewImage => {
                    if (previewImage) {
                        result.innerHTML = `
                            <p class="success">Live preview captured successfully!</p>
                            <p class="info">Image size: ${previewImage.length} characters</p>
                            <img src="${previewImage}" style="max-width: 200px; border: 1px solid #ccc; margin-top: 10px;">
                        `;
                    } else {
                        result.innerHTML = '<p class="error">Live preview capture failed!</p>';
                    }
                }).catch(error => {
                    result.innerHTML = `<p class="error">Error: ${error.message}</p>`;
                });
            } else {
                result.innerHTML = '<p class="error">testFrameCapture function not available. Make sure you\'re on the customize page.</p>';
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkCartData();
        });
    </script>
</body>
</html>
