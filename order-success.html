<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmed - JB Creations</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root{
            --bg: #0f3f49;
            --bg-2:#16697A;
            --brand:#489FB5;
            --accent:#82C09A;
            --card:#ffffff;
            --text:#0f172a;
            --muted:#64748b;
            --ring: rgba(72,159,181,0.25);
            --radius:16px;
            --shadow: 0 10px 30px rgba(8, 47, 73, 0.18);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
            background: linear-gradient(160deg, var(--bg) 0%, var(--bg-2) 50%, var(--accent) 130%);
            min-height: 100svh;
            display: flex;
            align-items: stretch;
            justify-content: center;
            color: var(--text);
        }

        .page {
            width: 100%;
            max-width: 520px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 16px 16px calc(16px + env(safe-area-inset-bottom));
        }

        .card {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .success-hero{
            display:flex;
            flex-direction: column;
            align-items:center;
            text-align:center;
            padding: 24px 20px 16px;
            background: linear-gradient(135deg, var(--bg-2), var(--brand));
            color:#fff;
            border-radius: var(--radius);
            position: relative;
        }
        .success-hero .icon{
            width:76px; height:76px; border-radius:999px; background: var(--accent);
            display:grid; place-items:center; box-shadow: 0 8px 18px rgba(130,192,154,.45);
            margin-bottom:10px;
            animation: pop .6s ease-out;
        }
        .success-hero .icon i{ color:#fff; font-size:36px; }
        .success-hero h1{ font-size:22px; line-height:1.2; font-weight:700; margin: 6px 0 4px; }
        .success-hero p{ font-size:13px; opacity:.95; }

        @keyframes pop { 0%{transform:scale(.7); opacity:.2} 100%{transform:scale(1); opacity:1} }

        .order-chip{
            display:flex; align-items:center; gap:8px; justify-content:center;
            margin: 14px auto 0; padding: 10px 12px; border-radius: 999px;
            background: rgba(255,255,255,.15); backdrop-filter: blur(6px);
            border:1px solid rgba(255,255,255,.25);
        }
        .order-chip .label{ font-size:12px; opacity:.9 }
        .order-chip .value{ font-family: 'Courier New', ui-monospace, SFMono-Regular, Menlo, monospace; font-weight:700; }
        .order-chip button{
            background: rgba(255,255,255,.2); border:1px solid rgba(255,255,255,.35); color:#fff;
            padding:6px 10px; border-radius:999px; font-size:12px; font-weight:600; cursor:pointer;
        }

        .section { padding: 14px; }

        .summary { display:grid; gap:10px; }
        .row { display:flex; align-items:center; justify-content:space-between; padding: 12px 10px; border-radius:12px; background:#f8fafc; }
        .row .label{ color: var(--muted); font-size:13px; }
        .row .value{ color: var(--text); font-weight:600; font-size:14px; }
        .row .value.amount{ color: var(--accent); font-size:16px; }

        .info { padding: 12px 14px 14px; }
        .info h3{ font-size:14px; color: var(--bg-2); display:flex; align-items:center; gap:8px; margin-bottom:8px; }
        .info ul{ list-style:none; display:grid; gap:8px; }
        .info li{ display:flex; align-items:center; gap:10px; color:#334155; font-size:13px; }
        .info li i{ color: var(--accent); }

        .spacer { height: 68px; }

        .sticky-actions{
            position: sticky; bottom: 0; z-index: 10;
            margin-top:auto;
        }
        .sticky-actions .bar{
            background: rgba(255,255,255,.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(15,63,73,.35);
            padding: 10px 10px calc(10px + env(safe-area-inset-bottom));
            display:grid; grid-template-columns: 1fr 1fr; gap:10px;
        }
        .btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:14px 12px; border-radius:12px; font-weight:700; font-size:14px; text-decoration:none; border:0; cursor:pointer; transition: transform .15s ease, filter .15s ease; }
        .btn:active{ transform: translateY(1px) scale(.99); }
        .btn-primary{ background: linear-gradient(135deg, var(--bg-2), var(--brand)); color:#fff; }
        .btn-secondary{ background:#f1f5f9; color: var(--bg-2); border:1px solid #e2e8f0; }

        /* Larger screens enhancements */
        @media (min-width: 600px){
            .page{ padding: 24px; gap:20px; }
            .success-hero{ padding: 28px 24px 18px; }
            .section{ padding: 16px; }
            .sticky-actions .bar{ grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <div class="page">
        <section class="success-hero card">
            <div class="icon"><i class="fas fa-check"></i></div>
            <h1>Order Confirmed</h1>
            <p>Thanks for choosing JB Creations</p>
            <div class="order-chip">
                <span class="label">Order ID</span>
                <span class="value" id="orderNumber">Loading...</span>
                <button type="button" id="copyOrderIdBtn"><i class="fa-regular fa-clone"></i> Copy</button>
            </div>
        </section>

        <section class="card section">
            <div class="summary">
                <div class="row">
                    <span class="label">Customer</span>
                    <span class="value" id="customerName">Loading...</span>
                </div>
                <div class="row">
                    <span class="label">Email</span>
                    <span class="value" id="customerEmail">Loading...</span>
                </div>
                <div class="row">
                    <span class="label">Payment</span>
                    <span class="value" style="color: var(--accent);"><i class="fas fa-check-circle"></i> Paid</span>
                </div>
                <div class="row">
                    <span class="label">Total</span>
                    <span class="value amount" id="totalAmount">Loading...</span>
                </div>
                <div class="row">
                    <span class="label">Date</span>
                    <span class="value" id="orderDate">Loading...</span>
                </div>
            </div>
        </section>

        <section class="card info">
            <h3><i class="fas fa-info-circle"></i> What happens next?</h3>
            <ul>
                <li><i class="fas fa-envelope"></i> You’ll receive a confirmation email shortly</li>
                <li><i class="fas fa-cog"></i> Your photos will be professionally processed</li>
                <li><i class="fas fa-print"></i> High-quality prints will be created and framed</li>
                <li><i class="fas fa-truck"></i> Your order will be carefully packaged and shipped</li>
                <li><i class="fas fa-bell"></i> Track your order status anytime with your order number</li>
            </ul>
        </section>

        <div class="spacer" aria-hidden="true"></div>

        <div class="sticky-actions">
            <div class="bar">
                <a href="#" class="btn btn-primary" id="trackOrderBtn"><i class="fas fa-search"></i> Track Order</a>
                <a href="index.html" class="btn btn-secondary"><i class="fas fa-home"></i> Home</a>
            </div>
        </div>
    </div>

    <script>
        // Get order details from URL parameters or sessionStorage
        function getOrderDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const orderNumber = urlParams.get('order') || sessionStorage.getItem('lastOrderNumber');
            const customerName = urlParams.get('name') || sessionStorage.getItem('lastCustomerName') || 'Valued Customer';
            const customerEmail = urlParams.get('email') || sessionStorage.getItem('lastCustomerEmail') || '';
            const totalAmount = urlParams.get('amount') || sessionStorage.getItem('lastOrderAmount') || '299';
            const isGuest = urlParams.get('guest') === 'true' || !sessionStorage.getItem('user');

            return {
                orderNumber,
                customerName,
                customerEmail,
                totalAmount,
                isGuest
            };
        }

        // Populate order details
        function populateOrderDetails() {
            const details = getOrderDetails();
            
            // Generate fallback order number in yearmonthdatetimeseconds+phone format
            const generateFallbackOrderNumber = (customerPhone = '') => {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const date = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                
                // Extract last 4 digits of phone number, default to random if not available
                let phoneLastFour = '0000';
                if (customerPhone) {
                    const digitsOnly = customerPhone.replace(/\D/g, '');
                    if (digitsOnly.length >= 4) {
                        phoneLastFour = digitsOnly.slice(-4);
                    } else if (digitsOnly.length > 0) {
                        phoneLastFour = digitsOnly.padStart(4, '0');
                    }
                } else {
                    phoneLastFour = Math.floor(1000 + Math.random() * 9000).toString();
                }
                
                return `JB${year}${month}${date}${hours}${minutes}${seconds}${phoneLastFour}`;
            };
            
            // Update DOM elements
            const orderId = details.orderNumber || generateFallbackOrderNumber(details.customerPhone);
            document.getElementById('orderNumber').textContent = orderId;
            document.getElementById('customerName').textContent = details.customerName;
            document.getElementById('customerEmail').textContent = details.customerEmail || 'Not provided';
            document.getElementById('totalAmount').textContent = '₹' + details.totalAmount;
            document.getElementById('orderDate').textContent = new Date().toLocaleDateString('en-IN', {
                year: 'numeric', month: 'long', day: 'numeric'
            });

            // Update track order button
            const trackBtn = document.getElementById('trackOrderBtn');
            if (details.isGuest && orderId) {
                trackBtn.href = `track-order.html?order=${orderId}`;
            } else {
                trackBtn.href = 'my-orders.html';
                trackBtn.innerHTML = '<i class="fas fa-list"></i> My Orders';
            }

            // Copy button wiring
            const copyBtn = document.getElementById('copyOrderIdBtn');
            if (copyBtn) {
                copyBtn.addEventListener('click', async () => {
                    try {
                        await navigator.clipboard.writeText(orderId);
                        copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied';
                        setTimeout(() => copyBtn.innerHTML = '<i class="fa-regular fa-clone"></i> Copy', 1200);
                    } catch (e) {
                        // Fallback
                        const tmp = document.createElement('textarea');
                        tmp.value = orderId; document.body.appendChild(tmp); tmp.select();
                        document.execCommand('copy'); document.body.removeChild(tmp);
                        copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied';
                        setTimeout(() => copyBtn.innerHTML = '<i class="fa-regular fa-clone"></i> Copy', 1200);
                    }
                });
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            populateOrderDetails();
            
            // Clear temporary order data after displaying
            setTimeout(() => {
                sessionStorage.removeItem('lastOrderNumber');
                sessionStorage.removeItem('lastCustomerName');
                sessionStorage.removeItem('lastCustomerEmail');
                sessionStorage.removeItem('lastOrderAmount');
            }, 5000);
        });
    </script>
</body>
</html>