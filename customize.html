<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customize Your Frame - Xidlz</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* Fix mobile header positioning - override style.css relative positioning */
        @media (max-width: 600px) {
            .site-header {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                z-index: 2500 !important;
                background: #EDE7E3 !important;
                box-shadow: none !important;
            }
            
            body.customize-page {
                padding-top: 56px !important;
            }
            
            .mainCustomizeContainer,
            #mainCustomizeContainer {
                margin-top: 0 !important;
            }
        }
        
        @media (max-width: 400px) {
            .site-header {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                z-index: 2500 !important;
                background: #EDE7E3 !important;
            }
            
            body.customize-page {
                padding-top: 52px !important;
            }
            
            .mainCustomizeContainer,
            #mainCustomizeContainer {
                margin-top: 0 !important;
            }
        }
        
        /* Mobile-only Update Room Previews button styling */
        #mobileUpdateRoomPreviews {
            display: none;
            width: 100%;
            margin: 8px 0 12px 0;
            padding: 10px 12px;
            background: #82C0CC;
            color: #0b3a45;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            box-shadow: 0 6px 16px rgba(0,0,0,0.08);
        }
        @media (max-width: 768px) {
            /* Show mobile button above room images; hide desktop header button on mobile */
            #mobileUpdateRoomPreviews { display: block; }
            #updateRoomPreviews { display: none !important; }
        }
        
        /* Ensure bottom bar is hidden in room preview mode - Critical Override */
        body.room-preview-active .mobile-bottom-bar,
        body.room-preview-active #mobileBottomBar {
            display: none !important;
        }
        body.room-preview-active .mobile-adjustments-container {
            display: none !important;
        }
        body.room-preview-active .mobile-dropup,
        body.room-preview-active #mobileDropup {
            display: none !important;
        }
        
        /* Hide texture option completely on mobile */
        .desktop-card[data-type="texture"],
        .mobile-texture-grid,
        .bar-tab[data-target="texture"],
        .drawer[data-drawer="texture"] {
            display: none !important;
        }

        /* ========================================
           FULL-WIDTH UPLOAD HERO SECTION
           Matches homepage hero styling
        ======================================== */
        .upload-hero-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .upload-hero-section {
            background: linear-gradient(145deg, #16697A 0%, #489FB5 100%);
            border-radius: 32px;
            padding: 48px 40px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
            color: white;
            text-align: center;
        }

        .upload-hero-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -30%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }

        .upload-hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.15);
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 0.85rem;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .upload-hero-section h1 {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            font-weight: 800;
            margin-bottom: 12px;
            line-height: 1.2;
        }

        .upload-hero-section > p {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 500px;
            margin: 0 auto 24px;
        }

        .upload-box-wrapper {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 32px;
            max-width: 600px;
            margin: 0 auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
        }

        .upload-box-wrapper .upload-header {
            color: #16697A;
            margin-bottom: 16px;
        }

        .upload-box-wrapper .upload-header h2 {
            color: #16697A;
            font-size: 1.3rem;
        }

        .upload-box-wrapper .upload-header i {
            color: #16697A;
        }

        /* Remove frame border in upload box */
        .upload-box-wrapper .frame {
            border: none !important;
            box-shadow: none !important;
            background: transparent !important;
        }

        .upload-box-wrapper .frame .image-container {
            border: none !important;
            box-shadow: none !important;
        }

        .upload-box-wrapper .upload-overlay {
            border: 2px dashed #82C0CC !important;
            border-color: #82C0CC !important;
        }

        /* Instructions Section - Compact 2x2 Grid */
        .upload-instructions {
            background: white;
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(22, 105, 122, 0.08);
        }

        .instructions-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .instructions-header h2 {
            font-size: 1.3rem;
            color: #1a3a42;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .instructions-header p {
            color: #5a7a82;
            font-size: 0.9rem;
            display: none; /* Hide subtitle for compact design */
        }

        .instructions-steps {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            grid-template-rows: auto auto;
            gap: 8px;
            align-items: center;
            justify-items: center;
            max-width: 400px;
            margin: 0 auto;
        }

        .instruction-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 8px;
        }

        .step-icon-box {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #82C0CC, #489FB5);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 6px;
            font-size: 1.4rem;
            box-shadow: 0 3px 8px rgba(22, 105, 122, 0.2);
        }

        .instruction-step h4 {
            font-size: 0.8rem;
            color: #1a3a42;
            font-weight: 700;
            margin: 0;
            white-space: nowrap;
        }

        .instruction-step p {
            display: none; /* Hide descriptions for compact design */
        }

        .step-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #FFA62B;
        }

        /* Grid positions for 2x2 layout - 2 rows only */
        .instruction-step:nth-child(1) { grid-column: 1; grid-row: 1; } /* Upload Photo - top left */
        .step-arrow:nth-child(2) { grid-column: 2; grid-row: 1; } /* Arrow right */
        .instruction-step:nth-child(3) { grid-column: 3; grid-row: 1; } /* Adjust & Crop - top right */
        .instruction-step:nth-child(4) { grid-column: 1; grid-row: 2; } /* Customize Frame - bottom left */
        .step-arrow:nth-child(5) { grid-column: 2; grid-row: 2; } /* Arrow right */
        .instruction-step:nth-child(6) { grid-column: 3; grid-row: 2; } /* Add to Cart - bottom right */

        @media (max-width: 768px) {
            .upload-hero-wrapper {
                padding: 8px;
            }

            .upload-hero-section {
                padding: 20px 16px;
                border-radius: 16px;
            }
            
            .upload-hero-section h1 {
                font-size: 1.3rem;
                margin-bottom: 8px;
            }
            
            .upload-hero-section > p {
                display: none;
            }
            
            .upload-hero-badge {
                padding: 6px 12px;
                font-size: 0.75rem;
                margin-bottom: 12px;
            }

            .upload-box-wrapper {
                padding: 16px;
            }
            
            .upload-box-wrapper .upload-header h2 {
                font-size: 1rem;
            }
            
            .upload-box-wrapper .frame {
                min-height: 180px !important;
            }
            
            .upload-box-wrapper .image-container {
                min-height: 180px !important;
            }

            .instructions-steps {
                max-width: 320px;
                gap: 6px;
            }

            .step-icon-box {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }

            .instruction-step h4 {
                font-size: 0.7rem;
            }

            .step-arrow {
                font-size: 1rem;
            }
            
            .upload-instructions {
                padding: 16px;
                border-radius: 16px;
            }
            
            .instructions-header {
                margin-bottom: 12px;
            }
            
            .instructions-header h2 {
                font-size: 1.1rem;
            }
        }
    </style>
    <!-- Global Header Component -->
    <script src="global-header.js"></script>
</head>
<body class="customize-page">
    <!-- GlobalWebsiteHeader Component Container -->
    <div id="global-header-container"></div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            GlobalWebsiteHeader.init();
        });
    </script>

    <!-- Upload Hero Section (Full Width - Shown Before Image Upload) -->
    <div class="upload-hero-wrapper" id="uploadHeroWrapper">
        <section class="upload-hero-section">
            <div class="upload-hero-badge">
                üì∏ Start Your Custom Frame
            </div>
            <h1>Upload Your Photo üñºÔ∏è</h1>
            <p>Choose a high-quality image and we'll help you create the perfect custom frame for your space.</p>
            
            <div class="upload-box-wrapper">
                <div class="upload-header">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h2>Select Your Image</h2>
                </div>
                <div class="frame" id="heroFrame" data-size="13x19" data-orientation="portrait" style="background: #f8f6f4; border-radius: 12px; min-height: 250px;">
                    <div class="image-container" id="heroImageContainer" style="min-height: 250px;">
                        <input type="file" id="heroImageUpload" accept="image/*" class="hidden-upload">
                        <div class="upload-overlay" id="heroUploadOverlay">
                            <i class="fas fa-cloud-upload-alt" style="color: #16697A;"></i>
                            <p style="color: #16697A;">Click here to upload your image</p>
                            <span class="upload-hint" style="color: #489FB5;">or drag and drop</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Instructions Section - Compact 2x2 Grid -->
        <section class="upload-instructions">
            <div class="instructions-header">
                <h2>What Happens Next? üé®</h2>
            </div>
            <div class="instructions-steps">
                <!-- Row 1: Upload Photo ‚Üí Adjust & Crop -->
                <div class="instruction-step">
                    <div class="step-icon-box">üì§</div>
                    <h4>Upload Photo</h4>
                </div>
                <div class="step-arrow"><i class="fas fa-arrow-right"></i></div>
                <div class="instruction-step">
                    <div class="step-icon-box">‚úÇÔ∏è</div>
                    <h4>Adjust & Crop</h4>
                </div>
                <!-- Row 2: Customize Frame ‚Üí Add to Cart -->
                <div class="instruction-step">
                    <div class="step-icon-box">üé®</div>
                    <h4>Customize Frame</h4>
                </div>
                <div class="step-arrow"><i class="fas fa-arrow-right"></i></div>
                <div class="instruction-step">
                    <div class="step-icon-box">üõí</div>
                    <h4>Add to Cart</h4>
                </div>
            </div>
        </section>
    </div>

    <!-- Hero Upload Script -->
    <script>
        // Handle hero upload section
        document.addEventListener('DOMContentLoaded', function() {
            const heroUpload = document.getElementById('heroImageUpload');
            const heroOverlay = document.getElementById('heroUploadOverlay');
            const heroWrapper = document.getElementById('uploadHeroWrapper');
            const mainContainer = document.getElementById('mainCustomizeContainer');
            const mainUpload = document.getElementById('imageUpload');

            if (heroOverlay) {
                heroOverlay.addEventListener('click', function() {
                    heroUpload.click();
                });
            }

            if (heroUpload) {
                heroUpload.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        // Hide hero wrapper, show main container
                        if (heroWrapper) heroWrapper.style.display = 'none';
                        if (mainContainer) mainContainer.style.display = 'grid';
                        
                        // Transfer the file to the main upload input
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        if (mainUpload) {
                            mainUpload.files = dataTransfer.files;
                            // Trigger the change event on main upload
                            const changeEvent = new Event('change', { bubbles: true });
                            mainUpload.dispatchEvent(changeEvent);
                        }
                    }
                });
            }

            // Enable drag and drop on hero section
            const heroFrame = document.getElementById('heroFrame');
            if (heroFrame) {
                heroFrame.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    heroFrame.style.borderColor = '#FFA62B';
                    heroFrame.style.background = 'rgba(255, 166, 43, 0.1)';
                });

                heroFrame.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    heroFrame.style.borderColor = '';
                    heroFrame.style.background = '#f8f6f4';
                });

                heroFrame.addEventListener('drop', function(e) {
                    e.preventDefault();
                    heroFrame.style.borderColor = '';
                    heroFrame.style.background = '#f8f6f4';
                    
                    const file = e.dataTransfer.files[0];
                    if (file && file.type.startsWith('image/')) {
                        // Hide hero wrapper, show main container
                        if (heroWrapper) heroWrapper.style.display = 'none';
                        if (mainContainer) mainContainer.style.display = 'grid';
                        
                        // Transfer the file to the main upload input
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        if (mainUpload) {
                            mainUpload.files = dataTransfer.files;
                            const changeEvent = new Event('change', { bubbles: true });
                            mainUpload.dispatchEvent(changeEvent);
                        }
                    }
                });
            }
        });
    </script>

    <!-- Main Container (Hidden Initially, Shown After Image Upload) -->
    <div class="container" id="mainCustomizeContainer" style="display: none;">
        <!-- Left Side: Upload and Preview Section -->
        <div class="left-section">
            <!-- Upload Section -->
            <div class="upload-section" id="uploadSection">
                <div class="rain-glass">
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="water-droplet"></div>
                    <div class="water-droplet"></div>
                    <div class="water-droplet"></div>
                    <div class="water-droplet"></div>
                </div>
                <div class="upload-header">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h2>Upload Your Image</h2>
                </div>
                <div class="frame" id="frame" data-size="13x19" data-orientation="portrait">
                    <div class="image-container" id="imageContainer">
                        <input type="file" id="imageUpload" accept="image/*" class="hidden-upload">
                        <div class="upload-overlay" id="uploadOverlay">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click here to upload your image</p>
                            <span class="upload-hint">or drag and drop</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview Section (Initially Hidden) -->
            <div class="preview-section hidden" id="previewSection">
                <div class="rain-glass">
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="water-droplet"></div>
                    <div class="water-droplet"></div>
                    <div class="water-droplet"></div>
                    <div class="water-droplet"></div>
                </div>
                <div class="preview-header">
                    <div class="preview-header-left">
                        <i class="fas fa-eye"></i>
                        <h2>Live Preview</h2>
                    </div>
                    <button id="changeImage" class="change-image-btn">
                        Change Image
                    </button>
                    <button id="updateRoomPreviews" class="change-image-btn" style="background: #82C0CC; margin-left: 10px;" onclick="updateRoomPreviewsClick()">
                        Update Room Previews
                    </button>
                </div>
                <div class="frame-preview" data-size="13x19" data-orientation="portrait">
                    <div class="frame-aspect-wrapper" data-size="13x19" data-orientation="portrait">
                        <div class="frame" data-size="13x19" data-orientation="portrait">
                            <div class="image-container">
                                <img id="previewImage" class="preview-image">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="preview-controls">
                    <div class="control-buttons">
                        <div class="zoom-controls">
                            <button id="zoomOut" title="Zoom Out (Large Step)"><i class="fas fa-minus"></i></button>
                            <button id="precisionZoomOut" class="precision-zoom" title="Precision Zoom Out (Fine Step)"><i class="fas fa-minus"></i></button>
                            <button id="precisionZoomIn" class="precision-zoom" title="Precision Zoom In (Fine Step)"><i class="fas fa-plus"></i></button>
                            <button id="zoomIn" title="Zoom In (Large Step)"><i class="fas fa-plus"></i></button>
                            <!-- Mobile-only change image button that overlays the pseudo-element -->
                            <button id="mobileChangeImage" class="mobile-change-image-btn" title="Change Image">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <!-- Mobile buttons for touch devices -->
                    <div class="mobile-controls">
                        <button class="mobile-zoom-btn mobile-zoom-out" title="Zoom Out">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="mobile-zoom-btn mobile-precision-zoom-out" title="Precision Zoom Out">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="mobile-zoom-btn mobile-precision-zoom-in" title="Precision Zoom In">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="mobile-zoom-btn mobile-zoom-in" title="Zoom In">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="mobile-change-btn" onclick="document.getElementById('imageUpload').click()" title="Change Image">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Mobile See Room Preview Button (shown only on mobile) -->
                <button id="mobileSeeRoomPreview" class="mobile-see-room-preview-btn">
                    <i class="fas fa-home"></i>
                    <span>See Room Preview</span>
                </button>
            </div>
        </div>

        <!-- Middle Section: Customization Cards -->
        <div class="middle-section">
            <div class="desktop-customization-section">
                <div class="desktop-customization-header">
                    <i class="fas fa-palette"></i>
                    <h2>Customize Your Frame</h2>
                </div>
                
                <!-- Desktop Compact Customization Cards -->
                <div class="desktop-customization-cards">
                    <div class="cards-container" id="cardsContainer">
                        <!-- Border Card -->
                        <div class="desktop-card active" data-type="border">
                            <div class="desktop-card-header">
                                <i class="fas fa-border-style"></i>
                                <span>Border</span>
                            </div>
                            <div class="desktop-card-content">
                                <div class="desktop-border-grid">
                                    <button class="desktop-border-btn" data-border="no">
                                        <i class="fas fa-times-circle"></i>
                                        <span>No</span>
                                    </button>
                                    <button class="desktop-border-btn" data-border="yes">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Yes</span>
                                    </button>
                                </div>
                                <p class="border-description">Add a white border inside the frame around your photo</p>
                            </div>
                        </div>

                        <!-- Size Card -->
                        <div class="desktop-card" data-type="size">
                            <div class="desktop-card-header">
                                <i class="fas fa-ruler-combined"></i>
                                <span>Size</span>
                            </div>
                            <div class="desktop-card-content">
                                <div class="desktop-size-grid">
                                    <button class="desktop-size-btn" data-size="13x19" data-orientation="portrait" data-price="499">
                                        <i class="fas fa-portrait"></i>
                                        <div class="size-info">
                                            <span class="size-text">13√ó19"</span>
                                            <span class="orientation">Portrait</span>
                                            <span class="price">‚Çπ499</span>
                                        </div>
                                    </button>
                                    <button class="desktop-size-btn" data-size="13x19" data-orientation="landscape" data-price="499">
                                        <i class="fas fa-image"></i>
                                        <div class="size-info">
                                            <span class="size-text">13√ó19"</span>
                                            <span class="orientation">Landscape</span>
                                            <span class="price">‚Çπ499</span>
                                        </div>
                                    </button>
                                    <button class="desktop-size-btn" data-size="13x10" data-orientation="portrait" data-price="349">
                                        <i class="fas fa-portrait"></i>
                                        <div class="size-info">
                                            <span class="size-text">13√ó10"</span>
                                            <span class="orientation">Portrait</span>
                                            <span class="price">‚Çπ349</span>
                                        </div>
                                    </button>
                                    <button class="desktop-size-btn" data-size="13x10" data-orientation="landscape" data-price="349">
                                        <i class="fas fa-image"></i>
                                        <div class="size-info">
                                            <span class="size-text">13√ó10"</span>
                                            <span class="orientation">Landscape</span>
                                            <span class="price">‚Çπ349</span>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Color Card -->
                        <div class="desktop-card" data-type="color">
                            <div class="desktop-card-header">
                                <i class="fas fa-fill-drip"></i>
                                <span>Color</span>
                            </div>
                            <div class="desktop-card-content">
                                <div class="desktop-color-grid">
                                    <button class="desktop-color-btn" data-color="black">
                                        <div class="color-preview black-preview"></div>
                                        <span>Black</span>
                                    </button>
                                    <button class="desktop-color-btn" data-color="white">
                                        <div class="color-preview white-preview"></div>
                                        <span>White</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Texture Card -->
                        <div class="desktop-card" data-type="texture">
                            <div class="desktop-card-header">
                                <i class="fas fa-layer-group"></i>
                                <span>Texture</span>
                            </div>
                            <div class="desktop-card-content">
                                <div class="desktop-texture-grid">
                                    <button class="desktop-texture-btn" data-texture="smooth">
                                        <i class="fas fa-grip-lines"></i>
                                        <span>Smooth</span>
                                    </button>
                                    <button class="desktop-texture-btn" data-texture="rough">
                                        <i class="fas fa-grip-lines-vertical"></i>
                                        <span>Rough</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Adjustments Card -->
                        <div class="desktop-card" data-type="adjustments">
                            <div class="desktop-card-header">
                                <i class="fas fa-sliders-h"></i>
                                <span>Adjust</span>
                            </div>
                            <div class="desktop-card-content">
                                <div class="desktop-adjustments-container">
                                    <div class="desktop-adjustment-item">
                                        <i class="fas fa-sun"></i>
                                        <span>Brightness</span>
                                        <input type="range" id="brightness" min="0" max="200" value="100">
                                    </div>
                                    <div class="desktop-adjustment-item">
                                        <i class="fas fa-adjust"></i>
                                        <span>Contrast</span>
                                        <input type="range" id="contrast" min="0" max="200" value="100">
                                    </div>
                                    <div class="desktop-adjustment-item">
                                        <i class="fas fa-lightbulb"></i>
                                        <span>Highlights</span>
                                        <input type="range" id="highlights" min="0" max="200" value="100">
                                    </div>
                                    <div class="desktop-adjustment-item">
                                        <i class="fas fa-moon"></i>
                                        <span>Shadows</span>
                                        <input type="range" id="shadows" min="0" max="200" value="100">
                                    </div>
                                    <div class="desktop-adjustment-item">
                                        <i class="fas fa-paint-brush"></i>
                                        <span>Vibrance</span>
                                        <input type="range" id="vibrance" min="0" max="200" value="100">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Navigation Bar -->
            <div class="navigation-bar">
                <div class="card-indicators-section">
                    <button class="card-nav-btn prev-card-btn" id="prevCardBtn" disabled>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    
                    <div class="card-indicators">
                        <div class="card-dot active" data-card="0"></div>
                        <div class="card-dot" data-card="1"></div>
                        <div class="card-dot" data-card="2"></div>
                        <div class="card-dot" data-card="3"></div>
                    </div>
                    
                    <button class="card-nav-btn next-card-btn" id="nextCardBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- Total Price Bar -->
            <div class="total-price-bar">
                <div class="bottom-bar-content">
                    <div class="price-and-cart">
                        <div class="total-price-section">
                            <i class="fas fa-tag"></i>
                            <span class="price-label">Total:</span>
                            <span class="price-value" id="totalPrice">‚Çπ0</span>
                        </div>
                        <button id="addToCart" class="floating-cart-btn" disabled>
                            <i class="fas fa-shopping-cart"></i>
                            <span>Add to Cart</span>
                        </button>
                    </div>
                </div>
            </div>

        </div>

        <!-- Right Section: Room Preview Section -->
        <div class="right-section">
            <div class="room-preview-section">
                <div class="rain-glass">
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="raindrop"></div>
                    <div class="water-droplet"></div>
                    <div class="water-droplet"></div>
                    <div class="water-droplet"></div>
                    <div class="water-droplet"></div>
                </div>
                <div class="preview-header">
                    <div class="preview-header-left">
                        <i class="fas fa-home"></i>
                        <h2>Room Preview</h2>
                    </div>
                </div>
                <!-- Mobile-only: manual update trigger placed above room images -->
                <button id="mobileUpdateRoomPreviews" onclick="updateRoomPreviewsClick()">
                    <i class="fas fa-sync-alt"></i> Update Room Previews
                </button>
                <div class="room-preview-container">
                    <!-- Default room preview image (shown when no frame size is selected) -->
                    <img src="Room-previewbackground.png" alt="Room Preview" class="room-preview-image default-preview" id="defaultRoomPreview">
                    
                    <!-- Frame-specific room preview slider (hidden by default) -->
                    <div class="room-slider-container" id="roomSliderContainer" style="display: none;">
                        <div class="room-slider" id="roomSlider">
                            <!-- Images will be dynamically loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Room Preview Navigation Bar -->
                <div class="room-navigation-bar">
                    <div class="room-indicators-section">
                        <button class="room-nav-btn prev" id="roomSliderPrev" title="Previous image">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        
                        <div class="room-indicators" id="sliderIndicators">
                            <!-- Dots will be dynamically added here -->
                        </div>
                        
                        <button class="room-nav-btn next" id="roomSliderNext" title="Next image">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
            </div>
        </div>
        
        <!-- Mobile Room Preview Page - Flipkart Style Listing (Hidden by default, shown when user clicks See Room Preview) -->
        <div id="mobileRoomPreviewPage" class="mobile-room-preview-page" style="display: none;">
            
            <!-- Main Content Container -->
            <div class="mobile-listing-content">
                <!-- Product Images Section (Horizontal Slider) -->
                <div class="product-images-section">
                    <div class="product-images-slider-container">
                        <div id="mobileRoomImagesList" class="mobile-product-images-slider">
                            <!-- Room images will be dynamically loaded here in horizontal slider format -->
                        </div>
                    </div>
                    <div class="slider-dots" id="sliderDots"></div>
                    
                    <!-- Change Frame Size Button -->
                    <button id="changeFrameSizeBtn" class="change-frame-size-btn">
                        <i class="fas fa-arrows-alt"></i>
                        <span>Change Frame Size</span>
                    </button>
                </div>
                
                <!-- Product Info Section -->
                <div class="product-info-section">
                    <!-- Title and Rating -->
                    <div class="product-header">
                        <h2 class="product-title">Customized Photo Frame</h2>
                        <div class="product-rating">
                            <span class="rating-stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                            </span>
                            <span class="rating-text">4.5 (1,234 reviews)</span>
                        </div>
                    </div>
                    
                    <!-- Price Section -->
                    <div class="product-price-section">
                        <div class="price-container">
                            <span class="current-price" id="mobileListingPrice">‚Çπ499</span>
                            <span class="original-price">‚Çπ999</span>
                            <span class="discount-badge">50% off</span>
                        </div>
                    </div>
                    
                    <!-- Specifications Section -->
                    <div class="product-specs-section">
                        <h3 class="section-title">Your Selections</h3>
                        <div class="specs-list">
                            <div class="spec-row">
                                <span class="spec-key">Size</span>
                                <span class="spec-value" id="mobileListingSize">13√ó19" Portrait</span>
                            </div>
                            <div class="spec-row">
                                <span class="spec-key">Frame Color</span>
                                <span class="spec-value" id="mobileListingColor">Black</span>
                            </div>
                            <div class="spec-row">
                                <span class="spec-key">Frame Texture</span>
                                <span class="spec-value" id="mobileListingTexture">Smooth</span>
                            </div>
                            <div class="spec-row">
                                <span class="spec-key">White Border</span>
                                <span class="spec-value" id="mobileListingBorder">No</span>
                            </div>
                            <div class="spec-row">
                                <span class="spec-key">Quality</span>
                                <span class="spec-value">Premium HD Print</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Features Section -->
                    <div class="product-features-section">
                        <h3 class="section-title">Key Features</h3>
                        <ul class="features-list">
                            <li><i class="fas fa-check-circle"></i> High-quality photo printing</li>
                            <li><i class="fas fa-check-circle"></i> Premium frame material</li>
                            <li><i class="fas fa-check-circle"></i> Easy wall mounting</li>
                            <li><i class="fas fa-check-circle"></i> Scratch resistant</li>
                        </ul>
                    </div>
                    
                    <!-- Delivery Info -->
                    <div class="delivery-info-section">
                        <h3 class="section-title">Delivery & Returns</h3>
                        <div class="delivery-item">
                            <i class="fas fa-truck"></i>
                            <div class="delivery-text">
                                <span class="delivery-label">Free Delivery</span>
                                <span class="delivery-desc">Estimated delivery by Dec 10</span>
                            </div>
                        </div>
                        <div class="delivery-item">
                            <i class="fas fa-undo"></i>
                            <div class="delivery-text">
                                <span class="delivery-label">Cancellation & Refund Policy</span>
                                <span class="delivery-desc">Delivery charges apply on cancellation or return as these are customized orders</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Fixed Bottom Add to Cart Bar -->
            <div class="mobile-listing-footer">
                <button id="mobileRoomAddToCart" class="add-to-cart-btn" disabled>
                    <i class="fas fa-shopping-cart"></i>
                    <span>ADD TO CART</span>
                </button>
            </div>
        </div>

        <!-- Mobile Controls Template (used by drop-up drawers) -->
        <template id="mobileControlsTemplate">
            <div class="mobile-border-grid">
                <button class="mobile-border-btn" data-border="no">
                    <i class="fas fa-times-circle"></i>
                    <span>No</span>
                </button>
                <button class="mobile-border-btn" data-border="yes">
                    <i class="fas fa-check-circle"></i>
                    <span>Yes</span>
                </button>
            </div>
            <div class="mobile-size-grid">
                <button class="mobile-size-btn" data-size="13x19" data-orientation="portrait" data-price="499">
                    <i class="fas fa-portrait"></i>
                    <div class="size-info">
                        <span class="size-text">13√ó19"</span>
                        <span class="orientation">Portrait</span>
                        <span class="price">‚Çπ499</span>
                    </div>
                </button>
                <button class="mobile-size-btn" data-size="13x19" data-orientation="landscape" data-price="499">
                    <i class="fas fa-image"></i>
                    <div class="size-info">
                        <span class="size-text">13√ó19"</span>
                        <span class="orientation">Landscape</span>
                        <span class="price">‚Çπ499</span>
                    </div>
                </button>
                <button class="mobile-size-btn" data-size="13x10" data-orientation="portrait" data-price="349">
                    <i class="fas fa-portrait"></i>
                    <div class="size-info">
                        <span class="size-text">13√ó10"</span>
                        <span class="orientation">Portrait</span>
                        <span class="price">‚Çπ349</span>
                    </div>
                </button>
                <button class="mobile-size-btn" data-size="13x10" data-orientation="landscape" data-price="349">
                    <i class="fas fa-image"></i>
                    <div class="size-info">
                        <span class="size-text">13√ó10"</span>
                        <span class="orientation">Landscape</span>
                        <span class="price">‚Çπ349</span>
                    </div>
                </button>
            </div>
            <div class="mobile-color-grid">
                <button class="mobile-color-btn" data-color="black">
                    <div class="color-preview black-preview"></div>
                    <span>Black</span>
                </button>
                <button class="mobile-color-btn" data-color="white">
                    <div class="color-preview white-preview"></div>
                    <span>White</span>
                </button>
            </div>
            <div class="mobile-texture-grid">
                <button class="mobile-texture-btn" data-texture="smooth">
                    <i class="fas fa-grip-lines"></i>
                    <span>Smooth</span>
                </button>
                <button class="mobile-texture-btn" data-texture="rough">
                    <i class="fas fa-grip-lines-vertical"></i>
                    <span>Rough</span>
                </button>
            </div>
            <div class="mobile-adjustments-container">
                <div class="mobile-adjustment-item">
                    <i class="fas fa-sun"></i>
                    <input type="range" id="mobileBrightness" min="0" max="200" value="100">
                </div>
                <div class="mobile-adjustment-item">
                    <i class="fas fa-adjust"></i>
                    <input type="range" id="mobileContrast" min="0" max="200" value="100">
                </div>
                <div class="mobile-adjustment-item">
                    <i class="fas fa-lightbulb"></i>
                    <input type="range" id="mobileHighlights" min="0" max="200" value="100">
                </div>
                <div class="mobile-adjustment-item">
                    <i class="fas fa-moon"></i>
                    <input type="range" id="mobileShadows" min="0" max="200" value="100">
                </div>
                <div class="mobile-adjustment-item">
                    <i class="fas fa-paint-brush"></i>
                    <input type="range" id="mobileVibrance" min="0" max="200" value="100">
                </div>
            </div>
        </template>
    </div>

    <!-- Firebase Backend Integration (Backup) -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    
    <!-- Fast2SMS OTP System (Primary) -->
    <script src="fast2sms-client.js?v=4.0"></script>
    
    <!-- Initialize Fast2SMS OTP Client BEFORE loading otp-auth-realsms.js -->
    <script>
        try {
            console.log('üîß Initializing Fast2SMS OTP Client for customize page...');
            window.otpClient = new Fast2SMSOTPClient();
            console.log('‚úÖ Fast2SMS OTP Client initialized successfully');
            console.log('üì° API Endpoint:', window.otpClient.apiBaseURL);
        } catch (error) {
            console.error('‚ùå Failed to initialize Fast2SMS client:', error);
        }
    </script>
    
    <!-- Main Scripts -->
    <script type="module" src="firebase-client-new.js?v=4.0"></script>
    <script src="otp-auth-realsms.js?v=4.0"></script>
    <script src="auth.js?v=4.0"></script>
    <script src="script.js?v=5.5-indexeddb"></script>
    <script>
        function setProfileDropdownState(isOpen) {
            const dropdownContainer = document.getElementById('profileDropdown');
            const dropdownMenu = document.getElementById('profileDropdownMenu');
            const profileBtn = document.getElementById('profileBtn');

            if (!dropdownContainer || !dropdownMenu || !profileBtn) {
                return;
            }

            dropdownContainer.classList.toggle('open', isOpen);
            profileBtn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
            dropdownMenu.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
        }

        function toggleProfileDropdown() {
            const dropdownContainer = document.getElementById('profileDropdown');
            if (!dropdownContainer) {
                return;
            }

            const isOpen = dropdownContainer.classList.contains('open');
            setProfileDropdownState(!isOpen);
        }

        function setupProfileDropdown() {
            const dropdownContainer = document.getElementById('profileDropdown');
            const dropdownMenu = document.getElementById('profileDropdownMenu');
            const profileBtn = document.getElementById('profileBtn');

            if (!dropdownContainer || !dropdownMenu || !profileBtn || dropdownContainer.dataset.dropdownInit === 'true') {
                return;
            }

            dropdownContainer.dataset.dropdownInit = 'true';

            profileBtn.setAttribute('aria-haspopup', 'true');
            profileBtn.setAttribute('aria-expanded', 'false');
            dropdownMenu.setAttribute('role', 'menu');
            dropdownMenu.setAttribute('aria-hidden', 'true');

            profileBtn.addEventListener('click', function(event) {
                event.preventDefault();
                event.stopPropagation();
                toggleProfileDropdown();
            });

            dropdownMenu.addEventListener('click', function(event) {
                const actionableItem = event.target.closest('a, button');
                if (actionableItem && actionableItem.dataset.closeDropdown === 'true') {
                    setProfileDropdownState(false);
                }
            });

            setProfileDropdownState(false);
        }

        // Profile dropdown functionality
        document.addEventListener('DOMContentLoaded', async function() {
            setupProfileDropdown();
            
            // Check authentication status
            await checkAuthStatus();
        });

        // Get current authenticated user from Firebase
        async function getCurrentAuthenticatedUser() {
            try {
                // Wait for Firebase to be ready with retry mechanism
                const maxRetries = 5; // Reduced from 10 since we now have the proper scripts
                for (let i = 0; i < maxRetries; i++) {
                    if (typeof window.otpAuth !== 'undefined') {
                        console.log('üì± Getting current user from Firebase...');
                        const user = await window.otpAuth.getCurrentUser();
                        console.log('üì± Firebase user result:', user);
                        return user;
                    } else {
                        console.log(`‚è≥ Firebase not ready yet, retrying... (${i + 1}/${maxRetries})`);
                        await new Promise(resolve => setTimeout(resolve, 300)); // Reduced from 500ms
                    }
                }
                
                console.log('‚ùå OTP Auth system not available after retries, falling back to localStorage');
                // Fallback to localStorage if Firebase is not available after retries
                const userDataStr = localStorage.getItem('jb_current_user');
                if (!userDataStr) return null;
                
                try {
                    return JSON.parse(userDataStr);
                } catch (parseError) {
                    console.log('Failed to parse user data as JSON, might be old format:', userDataStr);
                    if (userDataStr.startsWith('+91') || userDataStr.startsWith('+')) {
                        return { phone: userDataStr, name: 'User' };
                    }
                    return null;
                }
            } catch (error) {
                console.error('‚ùå Error getting current user from Firebase:', error);
                return null;
            }
        }

        // Check if user is authenticated and update UI accordingly
        async function checkAuthStatus() {
            try {
                const user = await getCurrentAuthenticatedUser();
                console.log('üì± checkAuthStatus - user found:', user);
                
                const guestOptions = document.getElementById('guestOptions');
                const authenticatedOptions = document.getElementById('authenticatedOptions');
                
                if (user && user.phone) {
                    console.log('üì± checkAuthStatus - user name:', user.name);
                    console.log('üì± checkAuthStatus - user phone:', user.phone);
                    
                    // User is logged in
                    if (guestOptions) guestOptions.style.display = 'none';
                    if (authenticatedOptions) authenticatedOptions.style.display = 'block';
                    
                    // Update user info in dropdown
                    const dropdownUserName = document.getElementById('dropdownUserName');
                    const dropdownUserPhone = document.getElementById('dropdownUserPhone');
                    
                    if (dropdownUserName) {
                        dropdownUserName.textContent = user.name || 'User';
                        console.log('üì± checkAuthStatus - Set dropdown name to:', user.name || 'User');
                    }
                    if (dropdownUserPhone) {
                        dropdownUserPhone.textContent = user.phone || 'Phone not available';
                    }
                } else {
                    showGuestState();
                }
                
                // Also call updateAuthUI for consistency with homepage
                await updateAuthUI();
            } catch (error) {
                console.log('Auth check error:', error);
                showGuestState();
            }
        }

        function showGuestState() {
            // Default to guest state
            const guestOptions = document.getElementById('guestOptions');
            const authenticatedOptions = document.getElementById('authenticatedOptions');
            if (guestOptions) guestOptions.style.display = 'block';
            if (authenticatedOptions) authenticatedOptions.style.display = 'none';
        }

        // Sign out function
        function signOut() {
            if (confirm('Are you sure you want to sign out?')) {
                localStorage.removeItem('jb_current_user');
                localStorage.removeItem('jb_users');
                window.location.reload();
            }
        }
        
        // Update authentication UI based on login status
        async function updateAuthUI() {
            try {
                const user = await getCurrentAuthenticatedUser();
                console.log('üì± updateAuthUI - user found:', user);
                
                const guestOptions = document.getElementById('guestOptions');
                const authenticatedOptions = document.getElementById('authenticatedOptions');
                const profileBtn = document.getElementById('profileBtn');
                
                if (user) {
                    console.log('üì± updateAuthUI - user name:', user.name);
                    console.log('üì± updateAuthUI - user phone:', user.phone);
                    
                    // User is logged in - show authenticated options, hide guest options
                    if (guestOptions) {
                        guestOptions.style.display = 'none';
                    }
                    if (authenticatedOptions) {
                        authenticatedOptions.style.display = 'block';
                    }
                    
                    // Update user info in dropdown
                    const dropdownUserName = document.getElementById('dropdownUserName');
                    const dropdownUserPhone = document.getElementById('dropdownUserPhone');
                    
                    if (dropdownUserName) {
                        dropdownUserName.textContent = user.name || 'User';
                        console.log('üì± updateAuthUI - Set dropdown name to:', user.name || 'User');
                    }
                    if (dropdownUserPhone) {
                        dropdownUserPhone.textContent = user.phone || 'Phone not available';
                    }
                    
                    // Always keep profile button text as "Profile"
                    if (profileBtn) {
                        profileBtn.innerHTML = `
                            <i class="fas fa-user-alt"></i>
                            <span class="button-label">Profile</span>
                        `;
                        profileBtn.style.color = '#16697A';
                    }
                } else {
                    // User is not logged in - show guest options, hide authenticated options
                    if (guestOptions) {
                        guestOptions.style.display = 'block';
                    }
                    if (authenticatedOptions) {
                        authenticatedOptions.style.display = 'none';
                    }
                    
                    // Reset profile button to default
                    if (profileBtn) {
                        profileBtn.innerHTML = `
                            <i class="fas fa-user-alt"></i>
                            <span class="button-label">Profile</span>
                        `;
                    }
                }
            } catch (error) {
                console.error('‚ùå Error updating auth UI:', error);
            }
        }
        
        // View user profile / toggle dropdown
        async function viewProfile() {
            window.location.href = 'my-profile.html';
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdownContainer = document.getElementById('profileDropdown');
            if (!dropdownContainer) {
                return;
            }

            if (!dropdownContainer.contains(event.target)) {
                setProfileDropdownState(false);
            }
        });

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                setProfileDropdownState(false);
            }
        });

        // View user orders
        function viewOrders() {
            window.location.href = 'my-orders.html';
        }
        
        // Contact us function
        function contactUs() {
            alert('Contact Us\n\nEmail: contact@jbcreations.com\nPhone: +91 12345 67890\nAddress: 123 Art Street, Creative City, India\n\nWe\'d love to hear from you!');
        }

        // About us function
        function aboutUs() {
            alert('About Xidlz\n\nWe are passionate about turning your precious memories into beautiful wall art. With years of experience in custom photo framing, we use premium materials and professional craftsmanship to create frames that last a lifetime.\n\nOur mission is to help you showcase your most cherished moments in style.');
        }
    </script>

        <!-- Mobile Fixed Bottom Customization Bar (always visible after image upload) -->
        <div class="mobile-bottom-bar" id="mobileBottomBar" aria-hidden="false">
            <div class="bar-tabs" role="tablist">
                <button class="bar-tab" data-target="border" role="tab" aria-selected="false">
                    <i class="fas fa-border-style"></i>
                    <span>Border</span>
                </button>
                <button class="bar-tab" data-target="size" role="tab" aria-selected="false">
                    <i class="fas fa-ruler-combined"></i>
                    <span>Size</span>
                </button>
                <button class="bar-tab" data-target="color" role="tab" aria-selected="false">
                    <i class="fas fa-fill-drip"></i>
                    <span>Color</span>
                </button>
                <button class="bar-tab" data-target="texture" role="tab" aria-selected="false">
                    <i class="fas fa-layer-group"></i>
                    <span>Texture</span>
                </button>
                <button class="bar-tab" data-target="adjust" role="tab" aria-selected="false">
                    <i class="fas fa-sliders-h"></i>
                    <span>Adjust</span>
                </button>
            </div>
        </div>

        <!-- Mobile Drop-up Drawer Container -->
        <div class="mobile-dropup" id="mobileDropup" aria-hidden="true">
            <div class="dropup-header">
                <span id="dropupTitle">Customize</span>
                <button id="dropupToggle" class="dropup-close" aria-label="Close and go back" aria-expanded="true">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            <div class="dropup-content">
                <div class="drawer" data-drawer="border"></div>
                <div class="drawer" data-drawer="size"></div>
                <div class="drawer" data-drawer="color"></div>
                <div class="drawer" data-drawer="texture"></div>
                <div class="drawer" data-drawer="adjust"></div>
            </div>
        </div>

</body>
</html>
