<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Orders - JB Creations</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Add CSS root variables for consistency */
        :root {
            --primary-color: #16697A; /* Caribbean Current - Teal */
            --secondary-color: #EDE7E3; /* Isabelline - Light Beige */
            --accent-color: #489FB5; /* Moonstone - Blue */
            --background-color: #EDE7E3; /* Isabelline - Light Beige */
            --text-color: #16697A; /* Caribbean Current for text */
            --card-background: #FFFFFF;
            --success-color: #82C0CC; /* Sky Blue */
            --highlight-color: #FFA62B; /* Orange Peel */
            --border-radius: 12px;
            --shadow: 0 4px 16px rgba(22, 105, 122, 0.1);
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .orders-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--background-color);
        }

        .page-header {
            background: linear-gradient(135deg, #82C0CC 0%, #489FB5 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(130, 192, 204, 0.3);
            margin-bottom: 30px;
            text-align: center;
        }

        .page-header h1 {
            color: white;
            margin-bottom: 10px;
        }

        .page-header p {
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
        }

        .user-info {
            background: #EDE7E3;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid rgba(22, 105, 122, 0.1);
        }

        .user-info h3 {
            margin-bottom: 15px;
            color: #16697A;
        }

        .user-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .user-detail {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(22, 105, 122, 0.8);
        }

        .orders-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(22, 105, 122, 0.1);
            overflow: hidden;
        }

        .section-header {
            background: #16697A;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-card {
            border-bottom: 1px solid #e9ecef;
            padding: 20px;
            transition: background 0.3s;
        }

        .order-card:hover {
            background: #EDE7E3;
        }

        .order-card:last-child {
            border-bottom: none;
        }

        .order-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .order-number {
            font-size: 18px;
            font-weight: 600;
            color: #16697A;
        }

        .order-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending {
            background: rgba(255, 166, 43, 0.1);
            color: #FFA62B;
        }

        .status-processing {
            background: rgba(72, 159, 181, 0.1);
            color: #489FB5;
        }

        .status-shipped {
            background: rgba(130, 192, 204, 0.1);
            color: #82C0CC;
        }

        .status-delivered {
            background: rgba(22, 105, 122, 0.1);
            color: #16697A;
        }

        .order-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .order-detail {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .detail-label {
            font-size: 12px;
            color: rgba(22, 105, 122, 0.7);
            text-transform: uppercase;
            font-weight: 600;
        }

        .detail-value {
            font-size: 14px;
            color: var(--text-color);
            font-weight: 500;
        }

        .order-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: #16697A;
            color: white;
        }

        .btn-primary:hover {
            background: #489FB5;
        }

        .btn-secondary {
            background: #6B6B6B;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-outline {
            background: white;
            color: #16697A;
            border: 2px solid #16697A;
        }

        .btn-outline:hover {
            background: #16697A;
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(22, 105, 122, 0.7);
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            color: rgba(130, 192, 204, 0.5);
        }

        .empty-state h3 {
            margin-bottom: 10px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #16697A;
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .orders-container {
                padding: 15px;
            }

            .page-header {
                padding: 20px;
            }

            .order-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .order-details {
                grid-template-columns: 1fr;
            }

            .order-actions {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Loading and Error States */
        .loading-state, .error-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(22, 105, 122, 0.7);
        }

        .loading-state i {
            font-size: 48px;
            color: var(--accent-color);
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }

        .error-state i {
            font-size: 48px;
            color: var(--highlight-color);
            margin-bottom: 20px;
        }

        .loading-state p, .error-state h3, .error-state p {
            margin: 10px 0;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Header and Dropdown Styles - Matching Homepage */
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .auth-section {
            display: flex;
            align-items: center;
        }

        .profile-dropdown {
            position: relative;
        }

        .profile-icon-btn {
            background: transparent;
            border: none;
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
            box-shadow: none;
            color: #16697A;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 22px;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            min-width: 50px;
            text-align: center;
        }

        .profile-icon-btn:hover {
            background: rgba(22, 105, 122, 0.25);
            border: 1px solid rgba(22, 105, 122, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            color: white;
        }

        .profile-icon-btn i {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin: 0;
            line-height: 1;
            font-size: 20px;
        }

        .profile-icon-btn .button-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            line-height: 1;
            margin: 0;
            width: 100%;
            text-align: center;
        }

        .profile-dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            min-width: 220px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            margin-top: 10px;
            padding: 8px 0;
        }

        .profile-dropdown:hover .profile-dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .profile-dropdown-menu .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #333;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            border-radius: 8px;
            margin: 2px 8px;
        }

        .profile-dropdown-menu .dropdown-item:hover {
            background: linear-gradient(135deg, rgba(72, 159, 181, 0.1), rgba(72, 159, 181, 0.05));
            color: #489FB5;
            transform: translateX(5px);
        }

        .profile-dropdown-menu .dropdown-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(72, 159, 181, 0.3), transparent);
            margin: 8px 16px;
        }

        /* User Info Section in Dropdown */
        .dropdown-user-info {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: rgba(22, 105, 122, 0.05);
            border-radius: 8px;
            margin: 8px;
        }

        .dropdown-user-info .user-avatar {
            font-size: 24px;
            color: #16697A;
            margin-right: 12px;
        }

        .dropdown-user-info .user-details {
            flex: 1;
        }

        .dropdown-user-info .user-name {
            font-weight: 600;
            color: #16697A;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .dropdown-user-info .user-phone {
            color: #489FB5;
            font-size: 12px;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 600px) {
            .header-right {
                gap: 10px;
            }

            .profile-icon-btn {
                min-width: 40px;
                font-size: 18px;
                padding: 6px 8px;
                gap: 2px;
            }

            .profile-icon-btn .button-label {
                font-size: 9px;
            }

            .cart-icon-btn {
                min-width: 40px;
                font-size: 16px;
                padding: 6px 8px;
                gap: 2px;
            }

            .cart-icon-btn .button-label {
                font-size: 9px;
            }

            .profile-dropdown-menu {
                min-width: 200px;
                right: -10px;
            }

            .profile-dropdown-menu .dropdown-item {
                padding: 10px 16px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="header-content">
            <div class="header-left"></div>
            <div class="header-brand">
                <h1 class="brand-name">JB Creations</h1>
            </div>
            <div class="header-right">
                <div class="auth-section" id="authSection">
                    <!-- Profile dropdown button (always visible) -->
                    <div class="profile-dropdown" id="profileDropdown">
                        <button class="profile-icon-btn" id="profileBtn">
                            <i class="fas fa-user-alt"></i>
                            <span class="button-label">Profile</span>
                        </button>
                        <div class="profile-dropdown-menu" id="profileDropdownMenu">
                            <!-- Guest user options -->
                            <div class="guest-options" id="guestOptions">
                                <a href="otp-login.html?redirect=my-orders.html" class="dropdown-item">
                                    <i class="fas fa-sign-in-alt"></i>
                                    Sign In
                                </a>
                                <a href="otp-login.html?redirect=my-orders.html" class="dropdown-item">
                                    <i class="fas fa-user-plus"></i>
                                    Sign Up
                                </a>
                                <div class="dropdown-divider"></div>
                            </div>
                            
                            <!-- Authenticated user options (hidden by default) -->
                            <div class="authenticated-options" id="authenticatedOptions" style="display: none;">
                                <!-- User Info Section -->
                                <div class="dropdown-user-info" id="dropdownUserInfo">
                                    <div class="user-avatar">
                                        <i class="fas fa-user-circle"></i>
                                    </div>
                                    <div class="user-details">
                                        <div class="user-name" id="dropdownUserName">User</div>
                                        <div class="user-phone" id="dropdownUserPhone">Phone</div>
                                    </div>
                                </div>
                                <div class="dropdown-divider"></div>
                                
                                <a href="#" class="dropdown-item" onclick="viewProfile()">
                                    <i class="fas fa-user-circle"></i>
                                    My Profile
                                </a>
                                <a href="#" class="dropdown-item" onclick="viewOrders()">
                                    <i class="fas fa-box"></i>
                                    My Orders
                                </a>
                                <div class="dropdown-divider"></div>
                                <a href="#" class="dropdown-item" onclick="authUtils.logout()">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Sign Out
                                </a>
                                <div class="dropdown-divider"></div>
                            </div>
                            
                            <!-- Common options for all users -->
                            <a href="track-order.html" class="dropdown-item">
                                <i class="fas fa-search"></i>
                                Track Order
                            </a>
                            <a href="#" class="dropdown-item" onclick="contactUs()">
                                <i class="fas fa-envelope"></i>
                                Contact Us
                            </a>
                            <a href="#" class="dropdown-item" onclick="aboutUs()">
                                <i class="fas fa-info-circle"></i>
                                About Us
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="header-cart">
                    <button class="cart-icon-btn" id="headerCartBtn" onclick="window.location.href='cart.html'">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count" id="cartCount">0</span>
                        <span class="button-label">Cart</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="orders-container">
        <a href="index.html" class="back-link">
            <i class="fas fa-arrow-left"></i>
            Back to Home
        </a>

        <div class="page-header">
            <h1>My Orders</h1>
            <p>Track and manage your photo framing orders</p>
        </div>

        <div class="user-info" id="userInfo">
            <!-- User information will be populated here -->
        </div>

        <div class="orders-section">
            <div class="section-header">
                <h2>Order History</h2>
                <button class="action-btn btn-outline" onclick="refreshOrders()">
                    <i class="fas fa-refresh"></i>
                    Refresh
                </button>
            </div>
            
            <div id="ordersContainer">
                <div class="empty-state">
                    <i class="fas fa-spinner fa-spin"></i>
                    <h3>Loading your orders...</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    
    <!-- JB Creations Scripts -->
    <script src="firebase-client-new.js"></script>
    <script src="otp-auth-firebase.js"></script>
    <script src="auth.js"></script>
    <script>
        let currentUser = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('My Orders page loading...');
            
            // Profile dropdown is now handled by CSS hover - no JavaScript needed
            
            // Listen for global auth state changes
            window.addEventListener('auth-state-changed', function(event) {
                console.log('Auth state changed event:', event.detail);
                if (event.detail && event.detail.user) {
                    currentUser = event.detail.user;
                    console.log('Updated current user from auth event:', currentUser.name);
                    updateDropdownUserInfo();
                    // Don't redirect if we're on the orders page and got a user
                    if (!document.getElementById('ordersContainer').innerHTML.includes('Loading your orders')) {
                        try {
                            updateUserInfo();
                        } catch (error) {
                            console.warn('Error updating user info from auth event (non-critical):', error);
                        }
                        loadUserOrders();
                    }
                }
            });
            
            // Wait a bit for other authentication systems to load
            setTimeout(async () => {
                // Check if user is already authenticated globally first
                await checkGlobalAuthState();
                
                // Initialize dropdown state (will be updated after auth check)
                updateDropdownUserInfo();
                
                // Wait for Firebase to be ready
                if (!window.jbAPI) {
                    console.log('Waiting for Firebase to load...');
                    document.addEventListener('firebase-ready', initializePage);
                } else {
                    await initializePage();
                }
            }, 500);
        });

        // Check global authentication state
        async function checkGlobalAuthState() {
            try {
                console.log('Checking global authentication state...');
                
                // Method 1: Check if there's a global currentUser variable
                if (window.currentUser && window.currentUser.name) {
                    currentUser = window.currentUser;
                    console.log('Found global window.currentUser:', currentUser.name);
                    return;
                }
                
                // Method 2: Check if there's a global user from OTP auth
                if (window.otpAuth && typeof window.otpAuth.getCurrentUser === 'function') {
                    try {
                        const globalUser = await window.otpAuth.getCurrentUser();
                        if (globalUser && globalUser.name) {
                            currentUser = globalUser;
                            console.log('Found OTP auth user:', currentUser.name);
                            return;
                        }
                    } catch (e) {
                        console.log('OTP auth getCurrentUser failed:', e.message);
                    }
                }
                
                // Method 3: Check localStorage for session with more detailed parsing
                const sessionData = localStorage.getItem('jb_current_user');
                if (sessionData) {
                    try {
                        const session = JSON.parse(sessionData);
                        console.log('Session data:', session);
                        if (session && (session.name || session.user?.name) && (session.phone || session.user?.phone)) {
                            // Handle both direct session and nested user object
                            currentUser = session.user || session;
                            console.log('Found session user:', currentUser.name);
                            return;
                        }
                    } catch (e) {
                        console.log('Failed to parse session data:', e.message);
                    }
                }
                
                // Method 4: Try to get user data if phone exists in any form
                const phoneFromStorage = localStorage.getItem('userPhone') || 
                                       (sessionData && JSON.parse(sessionData).phone);
                if (phoneFromStorage && window.jbAPI) {
                    try {
                        const userResult = await window.jbAPI.getUserByPhone(phoneFromStorage);
                        if (userResult.success && userResult.user) {
                            currentUser = userResult.user;
                            console.log('Found user via phone lookup:', currentUser.name);
                            return;
                        }
                    } catch (e) {
                        console.log('Phone lookup failed:', e.message);
                    }
                }
                
                console.log('No global user found');
            } catch (error) {
                console.error('Error checking global auth state:', error);
            }
        }

        async function initializePage() {
            try {
                // Check Firebase authentication
                console.log('Checking Firebase authentication...');
                
                // First try to get current user from OTP auth system
                if (window.otpAuth && window.otpAuth.getCurrentUser) {
                    const globalUser = await window.otpAuth.getCurrentUser();
                    console.log('OTP Auth user:', globalUser);
                    if (globalUser) {
                        currentUser = globalUser;
                        console.log('User authenticated from OTP auth:', currentUser.name);
                        
                        try {
                            updateUserInfo();
                        } catch (error) {
                            console.warn('Error updating user info (non-critical):', error);
                        }
                        
                        updateDropdownUserInfo();
                        await updateAuthUI();
                        loadUserOrders();
                        return;
                    }
                }
                
                // Get current user session from localStorage
                const sessionData = localStorage.getItem('jb_current_user');
                if (!sessionData) {
                    console.log('No user session found, redirecting to login');
                    await redirectToLogin();
                    return;
                }

                const session = JSON.parse(sessionData);
                if (!session.phone) {
                    console.log('Invalid session data, redirecting to login');
                    await redirectToLogin();
                    return;
                }

                // Get user data from Firebase
                const userResult = await window.jbAPI.getUserByPhone(session.phone);
                if (!userResult.success || !userResult.user) {
                    console.log('User not found in Firebase, redirecting to login');
                    await redirectToLogin();
                    return;
                }

                currentUser = userResult.user;
                console.log('User authenticated:', currentUser.name);

                try {
                    updateUserInfo();
                } catch (error) {
                    console.warn('Error updating user info (non-critical):', error);
                }
                
                updateDropdownUserInfo();
                await updateAuthUI();
                loadUserOrders();
            } catch (error) {
                console.error('Authentication error:', error);
                await redirectToLogin();
            }
        }

        async function redirectToLogin() {
            // Store current page for redirect after login
            const currentPage = 'my-orders.html';
            
            // Update dropdown to show guest options before redirecting
            updateDropdownUserInfo();
            await updateAuthUI();
            
            window.location.href = `otp-login.html?redirect=${currentPage}`;
        }

        // Update user information display - Hide the user info section
        function updateUserInfo() {
            if (!currentUser) {
                console.log('No current user to update info for');
                return;
            }

            const userInfoContainer = document.getElementById('userInfo');
            if (!userInfoContainer) {
                console.log('User info container not found');
                return;
            }
            
            // Hide the user info container instead of showing account details
            userInfoContainer.style.display = 'none';
        }

        // Update dropdown user information
        function updateDropdownUserInfo() {
            const dropdownUserName = document.getElementById('dropdownUserName');
            const dropdownUserPhone = document.getElementById('dropdownUserPhone');
            const guestOptions = document.getElementById('guestOptions');
            const authenticatedOptions = document.getElementById('authenticatedOptions');

            console.log('Updating dropdown user info. Current user:', currentUser ? currentUser.name : 'null');

            if (currentUser && currentUser.name) {
                // User is authenticated - show authenticated options
                console.log('User is authenticated, showing authenticated options');
                if (dropdownUserName) dropdownUserName.textContent = currentUser.name;
                if (dropdownUserPhone) dropdownUserPhone.textContent = currentUser.phone || '';
                
                // Hide guest options and show authenticated options
                if (guestOptions) {
                    guestOptions.style.display = 'none';
                }
                if (authenticatedOptions) {
                    authenticatedOptions.style.display = 'block';
                }
            } else {
                // User is not authenticated - show guest options
                console.log('User is not authenticated, showing guest options');
                if (guestOptions) {
                    guestOptions.style.display = 'block';
                }
                if (authenticatedOptions) {
                    authenticatedOptions.style.display = 'none';
                }
            }
        }

        // Load user orders from Firebase
        async function loadUserOrders() {
            const ordersContainer = document.getElementById('ordersContainer');
            
            try {
                console.log('Loading orders for user:', currentUser.phone);
                
                // Show loading state
                ordersContainer.innerHTML = `
                    <div class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading your orders...</p>
                    </div>
                `;
                
                // Get user's orders from Firebase
                let userOrders = [];
                if (currentUser.orders && currentUser.orders.length > 0) {
                    // Orders are stored as references in user document
                    userOrders = currentUser.orders;
                } else {
                    // Try to fetch orders directly from orders collection
                    const ordersResult = await window.jbAPI.getOrdersByPhone(currentUser.phone);
                    if (ordersResult.success) {
                        userOrders = ordersResult.orders;
                    }
                }

                if (!userOrders || userOrders.length === 0) {
                    ordersContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-box-open"></i>
                            <h3>No orders yet</h3>
                            <p>You haven't placed any orders yet. Start creating your custom frames!</p>
                            <a href="index.html" class="action-btn btn-primary" style="margin-top: 20px;">
                                <i class="fas fa-plus"></i>
                                Create First Order
                            </a>
                        </div>
                    `;
                    return;
                }

                // Sort orders by date (newest first)
                const sortedOrders = userOrders.sort((a, b) => {
                    const dateA = a.orderDate ? new Date(a.orderDate) : new Date(0);
                    const dateB = b.orderDate ? new Date(b.orderDate) : new Date(0);
                    return dateB - dateA;
                });

                // Display orders
                ordersContainer.innerHTML = sortedOrders.map(order => {
                    const orderDate = order.orderDate ? new Date(order.orderDate).toLocaleDateString() : 'Unknown';
                    const itemCount = order.items ? order.items.length : (order.itemCount || 1);
                    const total = order.totalAmount || order.total || 0;
                    const status = order.status || 'pending';
                    const orderNumber = order.orderId || order.orderNumber || 'N/A';
                    const deliveryMethod = order.deliveryMethod || 'standard';
                    
                    return `
                        <div class="order-card">
                            <div class="order-header">
                                <div class="order-number">#${orderNumber}</div>
                                <div class="order-status status-${status}">
                                    ${status.charAt(0).toUpperCase() + status.slice(1)}
                                </div>
                            </div>
                            
                            <div class="order-details">
                                <div class="order-detail">
                                    <div class="detail-label">Order Date</div>
                                    <div class="detail-value">${orderDate}</div>
                                </div>
                                <div class="order-detail">
                                    <div class="detail-label">Items</div>
                                    <div class="detail-value">${itemCount} item${itemCount > 1 ? 's' : ''}</div>
                                </div>
                                <div class="order-detail">
                                    <div class="detail-label">Total</div>
                                    <div class="detail-value">₹${total}</div>
                                </div>
                                <div class="order-detail">
                                    <div class="detail-label">Delivery</div>
                                    <div class="detail-value">${deliveryMethod === 'express' ? 'Express' : 'Standard'}</div>
                                </div>
                            </div>

                            <div class="order-actions">
                                <button class="action-btn btn-primary" onclick="viewOrderDetails('${orderNumber}')">
                                    <i class="fas fa-eye"></i>
                                    View Details
                                </button>
                                <button class="action-btn btn-outline" onclick="trackOrder('${orderNumber}')">
                                    <i class="fas fa-truck"></i>
                                    Track Order
                                </button>
                                ${status === 'delivered' ? `
                                    <button class="action-btn btn-secondary" onclick="reorderItems('${orderNumber}')">
                                        <i class="fas fa-redo"></i>
                                        Reorder
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error loading orders:', error);
                ordersContainer.innerHTML = `
                    <div class="error-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Error Loading Orders</h3>
                        <p>There was a problem loading your orders. Please try again later.</p>
                        <button onclick="loadUserOrders()" class="action-btn btn-primary" style="margin-top: 20px;">
                            <i class="fas fa-redo"></i>
                            Try Again
                        </button>
                    </div>
                `;
            }
        }

        // View order details
        function viewOrderDetails(orderNumber) {
            alert(`Order details for ${orderNumber} will be shown here.\n\nThis would typically show:\n- Full order information\n- Images\n- Delivery address\n- Payment details\n- Status timeline`);
        }

        // Track order
        function trackOrder(orderNumber) {
            alert(`Order tracking for ${orderNumber}\n\nStatus: Processing\nEstimated delivery: 5-7 business days\n\nYou will receive email updates when your order status changes.`);
        }

        // Reorder items
        function reorderItems(orderNumber) {
            alert(`Reorder functionality for ${orderNumber} will be implemented.\n\nThis would:\n- Add the same items to cart\n- Allow modifications\n- Proceed to checkout`);
        }

        // Refresh orders
        function refreshOrders() {
            loadUserOrders();
        }

        // Setup user dropdown - Fixed to use correct IDs
        function setupUserDropdown() {
            const profileBtn = document.getElementById('profileBtn');
            const profileDropdown = document.getElementById('profileDropdown');

            if (profileBtn && profileDropdown) {
                profileBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    profileDropdown.classList.toggle('active');
                });

                document.addEventListener('click', function() {
                    profileDropdown.classList.remove('active');
                });
            }
        }

        // Sign out function
        function signOut() {
            // Clear user session
            localStorage.removeItem('jb_current_user');
            
            // Redirect to login page
            window.location.href = 'otp-login.html';
        }

        // Update authentication UI based on login status
        async function updateAuthUI() {
            try {
                const user = await getCurrentAuthenticatedUser();
                console.log('📱 updateAuthUI - user found:', user);
                
                const guestOptions = document.getElementById('guestOptions');
                const authenticatedOptions = document.getElementById('authenticatedOptions');
                const profileBtn = document.getElementById('profileBtn');
                
                if (user) {
                    console.log('📱 updateAuthUI - user name:', user.name);
                    console.log('📱 updateAuthUI - user phone:', user.phone);
                    
                    // User is logged in - show authenticated options, hide guest options
                    if (guestOptions) {
                        guestOptions.style.display = 'none';
                    }
                    if (authenticatedOptions) {
                        authenticatedOptions.style.display = 'block';
                    }
                    
                    // Update user info in dropdown
                    const dropdownUserName = document.getElementById('dropdownUserName');
                    const dropdownUserPhone = document.getElementById('dropdownUserPhone');
                    
                    if (dropdownUserName) {
                        dropdownUserName.textContent = user.name || 'User';
                        console.log('📱 updateAuthUI - Set dropdown name to:', user.name || 'User');
                    }
                    if (dropdownUserPhone) {
                        dropdownUserPhone.textContent = user.phone || 'Phone not available';
                    }
                    
                    // Always keep profile button text as "Profile"
                    if (profileBtn) {
                        profileBtn.innerHTML = `
                            <i class="fas fa-user-alt"></i>
                            <span class="button-label">Profile</span>
                        `;
                        profileBtn.style.color = '#16697A';
                    }
                } else {
                    // User is not logged in - show guest options, hide authenticated options
                    if (guestOptions) {
                        guestOptions.style.display = 'block';
                    }
                    if (authenticatedOptions) {
                        authenticatedOptions.style.display = 'none';
                    }
                    
                    // Reset profile button to default
                    if (profileBtn) {
                        profileBtn.innerHTML = `
                            <i class="fas fa-user-alt"></i>
                            <span class="button-label">Profile</span>
                        `;
                    }
                }
            } catch (error) {
                console.error('❌ Error updating auth UI:', error);
            }
        }
        
        // View profile / toggle dropdown
        function viewProfile() {
            const dropdown = document.getElementById('profileDropdownMenu');
            if (dropdown) {
                dropdown.style.opacity = dropdown.style.opacity === '1' ? '0' : '1';
                dropdown.style.visibility = dropdown.style.visibility === 'visible' ? 'hidden' : 'visible';
                dropdown.style.transform = dropdown.style.opacity === '1' ? 'translateY(0)' : 'translateY(-10px)';
            }
        }

        // Profile dropdown now uses CSS hover - no click handlers needed

        // View orders (current page)
        function viewOrders() {
            // Already on orders page
        }
        
        // Contact us function
        function contactUs() {
            alert('Contact Us\n\nEmail: info@jbcreations.com\nPhone: +91 98765 43210\nAddress: 123 Art Street, Creative City, India\n\nWe\'d love to hear from you!');
        }

        // About us function
        function aboutUs() {
            alert('About JB Creations\n\nWe are passionate about turning your precious memories into beautiful wall art. With years of experience in custom photo framing, we use premium materials and professional craftsmanship to create frames that last a lifetime.\n\nOur mission is to help you showcase your most cherished moments in style.');
        }
    </script>

    <!-- Professional Footer -->
    <footer class="footer">
        <div class="footer-content">
            <!-- Column 1: Company Info -->
            <div class="footer-column">
                <a href="index.html" class="footer-logo">JB Creations</a>
                <div class="footer-tagline">Custom Photo Frames & Memories</div>
                <p class="footer-description">
                    We are passionate about turning your precious memories into beautiful wall art. With premium materials and professional craftsmanship, we create frames that last a lifetime and showcase your most cherished moments in style.
                </p>
            </div>

            <!-- Column 2: Quick Links -->
            <div class="footer-column">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="customize.html">Our Services</a></li>
                    <li><a href="#gallery">Gallery</a></li>
                    <li><a href="customize.html">Custom Orders</a></li>
                    <li><a href="#" onclick="aboutUs(); return false;">About Us</a></li>
                    <li><a href="#" onclick="contactUs(); return false;">Contact</a></li>
                </ul>
            </div>

            <!-- Column 3: Services -->
            <div class="footer-column">
                <h3>Our Services</h3>
                <ul class="footer-links">
                    <li><a href="customize.html">Custom Photo Frames</a></li>
                    <li><a href="customize.html">Wood Frames</a></li>
                    <li><a href="customize.html">Metal Frames</a></li>
                    <li><a href="customize.html">Digital Printing</a></li>
                    <li><a href="#" onclick="contactUs(); return false;">Frame Repair</a></li>
                    <li><a href="#" onclick="contactUs(); return false;">Bulk Orders</a></li>
                </ul>
            </div>

            <!-- Column 4: Contact Info -->
            <div class="footer-column">
                <h3>Get In Touch</h3>
                <div class="contact-item">
                    <i class="fas fa-phone contact-icon"></i>
                    <div class="contact-text">
                        <strong>Call Us</strong>
                        +91 98765 43210
                    </div>
                </div>
                <div class="contact-item">
                    <i class="fas fa-envelope contact-icon"></i>
                    <div class="contact-text">
                        <strong>Email Us</strong>
                        info@jbcreations.com
                    </div>
                </div>
                <div class="contact-item">
                    <i class="fas fa-map-marker-alt contact-icon"></i>
                    <div class="contact-text">
                        <strong>Visit Us</strong>
                        123 Art Street, Creative City, India 400001
                    </div>
                </div>
                
                <!-- Social Media Links -->
                <div class="social-links">
                    <a href="https://facebook.com/jbcreations" class="social-icon" target="_blank" title="Follow us on Facebook">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="https://instagram.com/jbcreations" class="social-icon" target="_blank" title="Follow us on Instagram">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="https://wa.me/919876543210" class="social-icon" target="_blank" title="Chat with us on WhatsApp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Footer Bottom Section -->
        <div class="footer-bottom">
            <div class="footer-bottom-content">
                <div class="copyright">
                    © 2024 JB Creations. All rights reserved.
                </div>
                <div class="footer-bottom-links">
                    <a href="#privacy-policy">Privacy Policy</a>
                    <a href="#terms-conditions">Terms & Conditions</a>
                    <div class="designed-by">
                        Designed with <span class="heart">❤️</span> by JB Creations
                    </div>
                </div>
            </div>
        </div>
    </footer>

</body>
</html>
