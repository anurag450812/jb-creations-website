<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#16697A">
    <title>Checkout - Xidlz</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #16697A; /* Caribbean Current - Teal */
            --secondary-color: #EDE7E3; /* Isabelline - Light Beige */
            --accent-color: #489FB5; /* Moonstone - Blue */
            --accent-rgb: 72, 159, 181; /* RGB values for accent color */
            --background-color: #EDE7E3; /* Isabelline - Light Beige */
            --text-color: #16697A; /* Caribbean Current for text */
            --card-background: #FFFFFF;
            --success-color: #FFA62B; /* Orange Peel - Updated for checkout highlights */
            --highlight-color: #FFA62B; /* Orange Peel */
            --warning-color: #FFA62B; /* Orange Peel */
            --error-color: #dc3545;
            --border-color: rgba(22, 105, 122, 0.2);
            --shadow-light: 0 4px 16px rgba(22, 105, 122, 0.1);
            --shadow-medium: 0 8px 25px rgba(22, 105, 122, 0.15);
            --shadow-heavy: 0 15px 35px rgba(22, 105, 122, 0.2);
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 12px;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            line-height: 1.6;
            padding-top: 80px; /* Add space for fixed header */
            -webkit-tap-highlight-color: transparent;
        }

        /* Fix mobile header positioning - override style.css relative positioning */
        @media (max-width: 600px) {
            .site-header,
            #globalSiteHeader {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                z-index: 2500 !important;
                background: #EDE7E3 !important;
                box-shadow: none !important;
            }
            
            body {
                padding-top: 70px !important; /* Ensure content doesn't hide behind fixed header */
            }
        }
        
        @media (max-width: 400px) {
            .site-header,
            #globalSiteHeader {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                z-index: 2500 !important;
                background: #EDE7E3 !important;
            }
            
            body {
                padding-top: 65px !important;
            }
        }

        .checkout-container {
            max-width: 1400px;
            margin: 20px auto 0;
            padding: 30px 20px;
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 40px;
            min-height: calc(100vh - 200px);
        }

        .checkout-section {
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 40px;
            box-shadow: var(--shadow-medium);
            border: none;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            transition: var(--transition-smooth);
        }

        .checkout-section:hover {
            box-shadow: var(--shadow-heavy);
            transform: translateY(-2px);
        }

        .section-title {
            font-size: 28px;
            margin-bottom: 30px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 700;
            position: relative;
            padding-bottom: 15px;
        }

        .section-title i {
            color: var(--primary-color);
            font-size: 24px;
        }

        .form-group {
            margin-bottom: 28px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 16px;
            position: relative;
            transition: var(--transition-smooth);
        }

        .form-group.required label::after {
            content: ' *';
            color: var(--highlight-color);
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            background: var(--card-background);
            color: var(--text-color);
            transition: var(--transition-smooth);
            box-sizing: border-box;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #FFA62B;
            box-shadow: 0 0 0 4px rgba(255, 166, 43, 0.1);
            background: #FFFFFF;
            transform: translateY(-1px);
        }

        .form-group input:hover,
        .form-group textarea:hover,
        .form-group select:hover {
            border-color: var(--accent-color);
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(22, 105, 122, 0.5);
            font-style: italic;
        }

        /* Enhanced input validation states - only show after user interaction */
        .form-group input.touched:valid:not(:placeholder-shown) {
            border-color: var(--success-color);
        }

        .form-group input.touched:invalid:not(:placeholder-shown) {
            border-color: var(--error-color);
        }

        .form-group input.valid {
            border-color: var(--success-color);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23FFA62B' d='m2.3 6.73.6-.6c.15-.15.3-.3.44-.44l1.9-1.83L6.64 4.9c.15.15.3.3.44.44l-.6.6L4.9 7.8c-.15.15-.3.3-.44.44l-.6-.6z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }

        .form-group input.invalid,
        .form-group textarea.invalid {
            border-color: var(--error-color);
            background-color: rgba(220, 53, 69, 0.05);
            animation: shake 0.3s ease-in-out;
        }

        .form-group textarea.valid {
            border-color: var(--success-color);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Phone input container styles */
        .phone-input-container {
            display: flex;
            align-items: center;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--card-background);
            transition: var(--transition-smooth);
            overflow: hidden;
        }

        .phone-input-container:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(22, 105, 122, 0.1);
        }

        .phone-input-container:focus-within {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(72, 159, 181, 0.1);
            transform: translateY(-1px);
        }

        .phone-prefix {
            background-color: var(--secondary-color);
            color: var(--text-color);
            padding: 16px 12px;
            font-weight: 600;
            border-right: 1px solid var(--border-color);
            white-space: nowrap;
            font-size: 16px;
        }

        .phone-input-container input {
            border: none !important;
            outline: none;
            padding: 16px 15px;
            font-size: 16px;
            flex: 1;
            background: transparent;
            color: var(--text-color);
            box-shadow: none !important;
            margin: 0;
        }

        .phone-input-container input::placeholder {
            color: rgba(22, 105, 122, 0.5);
            font-style: italic;
        }

        .phone-input-container.valid {
            border-color: var(--success-color);
        }

        .phone-input-container.invalid {
            border-color: var(--error-color);
            background-color: rgba(220, 53, 69, 0.02);
            animation: shake 0.3s ease-in-out;
        }

        .delivery-option {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: var(--transition-smooth);
            background: var(--card-background);
            position: relative;
            overflow: hidden;
        }

        .delivery-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-color);
            opacity: 0;
            transition: var(--transition-smooth);
            z-index: 0;
        }

        .delivery-option * {
            position: relative;
            z-index: 1;
        }

        .delivery-option:hover {
            border-color: var(--primary-color);
            background: #FFFFFF;
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .delivery-option:hover::before {
            opacity: 0.05;
        }

        .delivery-option.selected {
            border-color: var(--primary-color);
            background: rgba(22, 105, 122, 0.05);
            box-shadow: var(--shadow-light);
        }

        .delivery-option.selected::before {
            opacity: 0.1;
        }

        .delivery-option input[type="radio"] {
            margin-right: 12px;
            accent-color: var(--primary-color);
        }

        .delivery-option label {
            cursor: pointer;
            margin: 0;
            font-weight: 600;
        }

        .delivery-option strong {
            display: block;
            font-size: 16px;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .delivery-option small {
            color: rgba(22, 105, 122, 0.7);
            font-size: 14px;
        }

        .order-summary {
            background: var(--card-background);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 0;
            margin-bottom: 25px;
            border: none;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(22, 105, 122, 0.08);
        }

        .order-item {
            display: flex;
            gap: 20px;
            margin: 0;
            padding: 25px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-bottom: 1px solid rgba(22, 105, 122, 0.08);
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .order-item:last-child {
            border-bottom: none;
            border-radius: 0 0 20px 20px;
        }

        .order-item:first-child {
            border-radius: 20px 20px 0 0;
            margin-top: 4px;
        }

        .order-item:only-child {
            border-radius: 20px;
            margin-top: 4px;
        }

        .order-item:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(22, 105, 122, 0.15);
        }

        .order-item-image {
            width: 110px;
            height: 110px;
            object-fit: contain;
            border-radius: 16px;
            border: none;
            transition: var(--transition-smooth);
            background: transparent;
            padding: 8px;
        }

        .order-item:hover .order-item-image {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(72, 159, 181, 0.2);
        }

        .order-item-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 110px;
        }

        .order-item-title {
            font-weight: 700;
            margin-bottom: 12px;
            font-size: 18px;
            color: var(--text-color);
            line-height: 1.3;
        }

        .order-item-specs {
            font-size: 14px;
            color: rgba(22, 105, 122, 0.65);
            margin-bottom: 12px;
            line-height: 1.6;
            background: rgba(22, 105, 122, 0.04);
            padding: 8px 12px;
            border-radius: 8px;
            border-left: 3px solid var(--accent-color);
        }

        .order-item-price {
            font-weight: 800;
            color: var(--primary-color);
            font-size: 22px;
            align-self: flex-end;
            font-weight: 800;
        }

        .total-section {
            border: none;
            padding: 30px;
            margin: 0;
            background: var(--card-background);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(22, 105, 122, 0.12);
            position: relative;
            overflow: hidden;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px 0;
            font-size: 16px;
            transition: var(--transition-smooth);
        }

        .total-row:not(.total-final) {
            border-bottom: 1px solid rgba(22, 105, 122, 0.08);
        }

        .total-row:hover:not(.total-final) {
            background: rgba(72, 159, 181, 0.04);
            margin: 0 -15px;
            padding: 12px 15px;
            border-radius: 10px;
        }

        .total-final {
            font-size: 26px;
            font-weight: 800;
            color: var(--text-color);
            border-top: 2px solid var(--primary-color);
            padding-top: 20px;
            margin-top: 20px;
            position: relative;
            background: rgba(22, 105, 122, 0.05);
            margin: 20px -15px 0;
            padding: 20px 15px;
            border-radius: 15px;
        }

        .total-final span:last-child {
            color: var(--primary-color);
            font-weight: 900;
        }

        .place-order-btn {
            width: 100%;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 22px 30px;
            border-radius: 18px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-smooth);
            margin-top: 30px;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(22, 105, 122, 0.3);
        }

        .place-order-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
            transition: left 0.6s ease;
        }

        .place-order-btn:hover::before {
            left: 100%;
        }

        .place-order-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(22, 105, 122, 0.4);
            background: var(--accent-color);
        }

        .place-order-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.2);
            transition: left 0.5s;
        }

        .place-order-btn:hover::before {
            left: 100%;
        }

        .place-order-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-heavy);
            background: var(--accent-color);
        }

        .place-order-btn:disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .place-order-btn i {
            margin-right: 10px;
            font-size: 20px;
        }

        .back-to-cart {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            color: var(--primary-color);
            text-decoration: none;
            margin-bottom: 25px;
            font-weight: 600;
            transition: var(--transition-smooth);
            padding: 10px 15px;
            border-radius: 8px;
            background: rgba(22, 105, 122, 0.1);
        }

        .back-to-cart:hover {
            color: var(--primary-color);
            transform: translateX(-5px);
            text-decoration: none;
            background: rgba(22, 105, 122, 0.2);
        }

        .back-to-cart i {
            font-size: 16px;
        }

        .delivery-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 12px;
        }

        .processing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 6000; /* Above mobile sticky bar and dropdowns */
            backdrop-filter: blur(5px);
        }

        .processing-content {
            background: white;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            max-width: 450px;
            box-shadow: var(--shadow-heavy);
            border: 1px solid var(--border-color);
        }

        .processing-spinner {
            font-size: 60px;
            color: var(--primary-color);
            margin-bottom: 25px;
        }

        .processing-spinner i {
            display: inline-block;
            animation: spin 1s linear infinite;
        }

        /* Loading dots animation */
        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }

        .processing-content h3 {
            margin-bottom: 15px;
            color: var(--text-color);
            font-size: 24px;
        }

        .processing-content p {
            color: rgba(22, 105, 122, 0.7);
            font-size: 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Success Checkmark Animation */
        .success-state {
            text-align: center;
        }

        .success-checkmark {
            width: 100px;
            height: 100px;
            margin: 0 auto 25px;
        }

        .checkmark {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: block;
            stroke-width: 2;
            stroke: #28a745;
            stroke-miterlimit: 10;
            animation: fill 0.4s ease-in-out 0.4s forwards, scale 0.3s ease-in-out 0.9s both;
        }

        .checkmark-circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #28a745;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }

        .checkmark-check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }

        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }

        @keyframes scale {
            0%, 100% {
                transform: none;
            }
            50% {
                transform: scale3d(1.1, 1.1, 1);
            }
        }

        @keyframes fill {
            100% {
                box-shadow: inset 0px 0px 0px 50px rgba(40, 167, 69, 0.1);
            }
        }

        .success-state h3 {
            color: #28a745;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .success-state p {
            color: rgba(22, 105, 122, 0.7);
            font-size: 16px;
        }

        /* Guest Checkout Styles */
        .user-status {
            background: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }

        .user-status::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-color);
        }

        .user-status.logged-in {
            background: #d4edda;
            border-color: var(--success-color);
            color: #155724;
        }

        .user-status.logged-in::before {
            background: var(--success-color);
        }

        .user-status.guest {
            background: rgba(72, 159, 181, 0.1);
            border-color: var(--accent-color);
        }

        .user-status.guest::before {
            background: var(--accent-color);
        }

        .checkout-options {
            text-align: center;
        }

        .option-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 25px;
            font-size: 20px;
            font-weight: 700;
            color: var(--text-color);
        }

        .option-header i {
            color: var(--primary-color);
            font-size: 24px;
        }

        .checkout-method-buttons {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .checkout-method-btn {
            flex: 1;
            min-width: 220px;
            padding: 25px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: var(--transition-smooth);
            text-align: left;
            display: flex;
            align-items: center;
            gap: 18px;
            position: relative;
            overflow: hidden;
        }

        .checkout-method-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-color);
            opacity: 0;
            transition: var(--transition-smooth);
            z-index: 0;
        }

        .checkout-method-btn * {
            position: relative;
            z-index: 1;
        }

        .checkout-method-btn:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .checkout-method-btn:hover::before {
            opacity: 0.05;
        }

        .checkout-method-btn.active {
            border-color: var(--primary-color);
            background: rgba(22, 105, 122, 0.05);
            box-shadow: var(--shadow-light);
        }

        .checkout-method-btn.active::before {
            opacity: 0.1;
        }

        .checkout-method-btn i {
            font-size: 28px;
            color: var(--primary-color);
        }

        .checkout-method-btn strong {
            display: block;
            color: var(--text-color);
            margin-bottom: 8px;
            font-size: 18px;
        }

        .checkout-method-btn small {
            color: rgba(22, 105, 122, 0.7);
            font-size: 14px;
            line-height: 1.4;
        }

        .guest-benefits {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-light);
        }

        .guest-benefits h4 {
            margin: 0 0 15px 0;
            color: var(--primary-color);
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }

        .guest-benefits ul {
            margin: 0;
            padding-left: 25px;
        }

        .guest-benefits li {
            margin-bottom: 8px;
            color: var(--text-color);
            font-size: 15px;
        }

        .guest-checkout-notice {
            background: rgba(255, 166, 43, 0.1);
            border: 1px solid rgba(255, 166, 43, 0.3);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .guest-checkout-notice::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--highlight-color);
        }

        .guest-checkout-notice i {
            color: #d4761a;
            font-size: 20px;
        }

        .guest-checkout-notice span {
            font-weight: 700;
            color: #d4761a;
            font-size: 16px;
        }

        .guest-checkout-notice small {
            color: rgba(22, 105, 122, 0.7);
            margin-left: auto;
            font-size: 14px;
        }

        .btn-link {
            background: none;
            border: none;
            color: var(--primary-color);
            text-decoration: underline;
            cursor: pointer;
            font-size: 14px;
            margin-left: 15px;
            font-weight: 600;
            transition: var(--transition-smooth);
        }

        .btn-link:hover {
            color: var(--accent-color);
            text-decoration: none;
        }

        /* Security and Trust Indicators */
        .security-indicators {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .security-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(22, 105, 122, 0.7);
            font-size: 14px;
        }

        .security-item i {
            color: var(--success-color);
            font-size: 16px;
        }

        /* Progress Indicator */
        .checkout-progress {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            padding: 0 20px;
        }

        .progress-steps {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 10px;
            color: rgba(22, 105, 122, 0.5);
            font-size: 14px;
            font-weight: 600;
        }

        .progress-step.active {
            color: var(--primary-color);
        }

        .progress-step.completed {
            color: var(--success-color);
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 12px;
        }

        .progress-step.active .step-circle {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        .progress-step.completed .step-circle {
            border-color: var(--success-color);
            background: var(--success-color);
            color: white;
        }

        .step-connector {
            width: 40px;
            height: 2px;
            background: var(--border-color);
        }

        .progress-step.active + .progress-step .step-connector,
        .progress-step.completed + .progress-step .step-connector {
            background: var(--primary-color);
        }

        /* Enhanced Order Summary Features */
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 25px 30px 20px;
            border-bottom: 1px solid rgba(22, 105, 122, 0.08);
            background: rgba(255, 255, 255, 0.9);
            margin: 0 0 0 0;
            border-radius: 20px 20px 0 0;
        }

        .order-count {
            color: white;
            font-size: 13px;
            background: var(--primary-color);
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(22, 105, 122, 0.3);
        }

        .promo-code-section {
            margin: 25px 30px;
            padding: 25px;
            background: rgba(130, 192, 204, 0.08);
            border-radius: 16px;
            border: 1px solid rgba(130, 192, 204, 0.2);
            position: relative;
            overflow: hidden;
        }

        .promo-code-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-color);
        }

        .promo-code-section label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 15px;
        }

        .promo-code-input {
            display: flex;
            gap: 12px;
            margin-top: 12px;
        }

        .promo-code-input input {
            flex: 1;
            padding: 14px 18px;
            border: 2px solid rgba(22, 105, 122, 0.1);
            border-radius: 12px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.8);
            transition: var(--transition-smooth);
        }

        .promo-code-input input:focus {
            border-color: #FFA62B;
            background: white;
            box-shadow: 0 4px 15px rgba(255, 166, 43, 0.15);
        }

        .promo-code-input button {
            padding: 14px 24px;
            background: #FFA62B;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            transition: var(--transition-smooth);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(255, 166, 43, 0.2);
        }

        .promo-code-input button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 166, 43, 0.3);
            background: #e5941f;
        }

        /* Estimated Delivery Date */
        .delivery-estimate {
            background: rgba(130, 192, 204, 0.1);
            border: 1px solid rgba(130, 192, 204, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
        }

        .delivery-estimate i {
            color: var(--success-color);
            margin-right: 8px;
        }

        .delivery-estimate strong {
            color: var(--success-color);
        }

        /* Form Enhancements */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group.half-width {
            margin-bottom: 20px;
        }

        .form-help-text {
            font-size: 12px;
            color: rgba(22, 105, 122, 0.6);
            margin-top: 5px;
            font-style: italic;
        }

        .pincode-loader {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--primary-color);
            margin-top: 5px;
            font-weight: 500;
        }

        .pincode-loader i {
            color: var(--accent-color);
        }

        /* Auto-filled field styling */
        .auto-filled {
            background-color: rgba(72, 159, 181, 0.1) !important;
            border-color: var(--accent-color) !important;
        }

        .auto-filled:focus {
            background-color: rgba(72, 159, 181, 0.15) !important;
        }

        /* Autocomplete styling */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: var(--shadow-medium);
        }

        .autocomplete-suggestion {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid rgba(22, 105, 122, 0.1);
            transition: var(--transition-smooth);
            font-size: 14px;
        }

        .autocomplete-suggestion:last-child {
            border-bottom: none;
        }

        .autocomplete-suggestion:hover {
            background-color: rgba(72, 159, 181, 0.1);
            color: var(--primary-color);
        }

        .autocomplete-suggestion.selected {
            background-color: var(--accent-color);
            color: white;
        }

        .no-suggestions {
            padding: 12px 16px;
            color: rgba(22, 105, 122, 0.6);
            font-style: italic;
            font-size: 14px;
        }

        .required-note {
            font-size: 14px;
            color: rgba(22, 105, 122, 0.7);
            margin-bottom: 20px;
            font-style: italic;
        }

        .required-note::before {
            content: '* ';
            color: var(--highlight-color);
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .checkout-container {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 15px;
            }

            .checkout-section {
                padding: 25px;
            }

            .section-title {
                font-size: 24px;
            }

            .delivery-options {
                grid-template-columns: 1fr;
            }

            .checkout-method-buttons {
                flex-direction: column;
            }

            .checkout-method-btn {
                min-width: unset;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }

            .progress-steps {
                gap: 10px;
            }

            .step-connector {
                width: 20px;
            }

            .security-indicators {
                flex-direction: column;
                gap: 10px;
            }

            /* Hide order summary, promo code, subtotal on mobile; keep sticky bar visible */
            #summarySection {
                display: none !important;
            }

            .promo-code-section {
                display: none !important;
            }

            .total-section {
                display: none !important;
            }

            /* Keep sticky bar visible for price + place order */
            .mobile-sticky-bar { display: block !important; }

            .place-order-btn {
                display: none !important;
            }

            /* Ensure content not hidden behind sticky bar */
            body { padding-bottom: calc(84px + env(safe-area-inset-bottom)); }
        }

        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .checkout-section {
                padding: 20px;
                margin: 10px;
            }

            .section-title {
                font-size: 20px;
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }

            .total-final {
                font-size: 20px;
            }

            .order-item-title {
                font-size: 16px;
            }

            .checkout-method-btn {
                padding: 20px;
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
        }

        /* Header and Dropdown Styles - Matching Homepage */


        /* Mobile Responsive Styles - Centralized in style.css */


        /* Mobile sticky checkout bar */
        .mobile-sticky-bar {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ffffff;
            box-shadow: 0 -8px 24px rgba(22, 105, 122, 0.12);
            border-top: 1px solid rgba(22,105,122,0.12);
            padding: 12px 14px;
            display: none;
            z-index: 3000;
        }

        .mobile-sticky-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            max-width: 700px;
            margin: 0 auto;
        }

        .mobile-total-box {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .mobile-total-label {
            font-size: 12px;
            color: rgba(22,105,122,0.7);
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .mobile-total-value {
            font-size: 18px;
            color: var(--primary-color);
            font-weight: 800;
        }

        .mobile-items-count {
            font-size: 12px;
            color: rgba(22,105,122,0.7);
            font-weight: 600;
        }

        .mobile-place-order-btn {
            background: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: 12px;
            padding: 14px 18px;
            font-size: 15px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 8px 22px rgba(22,105,122,0.32);
            flex-shrink: 0;
            min-height: 48px;
        }

        .mobile-place-order-btn i { font-size: 16px; }

        @media (max-width: 768px) {
            .mobile-sticky-bar { display: block; }
        }

        /* Make Total Payable section clickable */
        .mobile-total-box {
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 8px 12px;
            border-radius: 10px;
        }
        
        .mobile-total-box:hover,
        .mobile-total-box:active {
            background: rgba(22, 105, 122, 0.08);
        }
        
        .mobile-total-box .mobile-items-count {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .mobile-total-box .mobile-items-count::after {
            content: 'â–²';
            font-size: 8px;
            opacity: 0.7;
            transition: transform 0.3s ease;
        }
        
        .mobile-total-box.drawer-open .mobile-items-count::after {
            transform: rotate(180deg);
        }

        /* Mobile order drawer */
        .mobile-items-toggle {
            background: transparent;
            border: none;
            color: var(--primary-color);
            border-radius: 0;
            padding: 4px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: none;
        }
        .mobile-items-toggle:hover,
        .mobile-items-toggle:focus,
        .mobile-items-toggle:active {
            background: transparent;
            border: none;
            outline: none;
            box-shadow: none;
        }
        .mobile-items-toggle i { font-size: 14px; }

        .mobile-order-drawer {
            position: fixed;
            left: 0; right: 0; bottom: 0;
            background: #fff;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            box-shadow: 0 -10px 30px rgba(22,105,122,0.18);
            transform: translateY(100%);
            transition: transform .3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 3500;
            max-height: 70vh;
            display: flex;
            flex-direction: column;
            touch-action: none; /* Enable custom touch handling */
        }
        .mobile-order-drawer.open { transform: translateY(0); }
        .mobile-order-drawer.dragging { transition: none; } /* Disable transition while dragging */

        /* Swipe handle for drawer */
        .mobile-drawer-swipe-handle {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 10px 0 4px 0;
            cursor: grab;
            touch-action: none;
        }
        
        .mobile-drawer-swipe-handle::before {
            content: '';
            width: 40px;
            height: 4px;
            background: rgba(22, 105, 122, 0.3);
            border-radius: 2px;
            transition: background 0.2s ease;
        }
        
        .mobile-drawer-swipe-handle:active::before {
            background: rgba(22, 105, 122, 0.5);
        }

        .mobile-drawer-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            border-bottom: 1px solid rgba(22,105,122,0.12);
            font-weight: 800;
            color: var(--primary-color);
        }

        .mobile-drawer-close {
            background: transparent;
            border: none;
            color: var(--primary-color);
            padding: 6px;
            border-radius: 0;
        }
        .mobile-drawer-close:hover,
        .mobile-drawer-close:focus,
        .mobile-drawer-close:active {
            background: transparent;
            border: none;
            outline: none;
            box-shadow: none;
        }

        .mobile-drawer-content {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 8px 8px calc(84px + env(safe-area-inset-bottom));
        }

        .mobile-drawer-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.25);
            opacity: 0;
            pointer-events: none;
            transition: opacity .3s ease;
            z-index: 3400;
        }
        .mobile-drawer-backdrop.open { opacity: 1; pointer-events: auto; }

        /* Reuse order item visuals inside drawer */
    .mobile-order-drawer .order-item { border-bottom: 1px solid rgba(22,105,122,0.08); }
    .mobile-order-drawer .order-item-image { width: 84px; height: 84px; }
    .mobile-order-drawer .order-item-title { font-size: 15px; }
    .mobile-order-drawer .order-item-meta { font-size: 12px; opacity: 0.9; }
    .mobile-order-drawer .order-item-specs { display: block !important; font-size: 12px; color: rgba(22,105,122,0.85); margin-top: 4px; }

        /* Mobile-first enhancements and reordering */
        @media (max-width: 768px) {
            /* Reduce heavy shadows, increase readability */
            .checkout-section {
                box-shadow: none;
                border: 1px solid rgba(22, 105, 122, 0.12);
                background: #fff;
            }

            /* Reorder sections for mobile: show summary first, then form */
            #summarySection { order: 1; }
            #customerSection { order: 2; }

            .checkout-container {
                display: flex;
                flex-direction: column;
            }

            /* Touch-friendly form controls */
            .form-group input,
            .form-group textarea,
            .form-group select {
                min-height: 48px;
                font-size: 16px; /* Avoid iOS zoom */
            }

            .phone-input-container .phone-prefix { padding: 14px 12px; }
            .phone-input-container input { padding: 14px 15px; }

            /* Compact progress on mobile */
            .checkout-progress { margin-bottom: 10px; }
            .step-circle { width: 26px; height: 26px; font-size: 11px; }
            .progress-step { font-size: 12px; }
        }

        /* Collapsible order items on mobile */
        .order-toggle-row {
            display: none;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            padding: 0 20px 15px 20px;
        }

        .order-toggle-btn {
            background: rgba(22,105,122,0.08);
            color: var(--primary-color);
            border: 1px solid rgba(22,105,122,0.18);
            padding: 10px 14px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .order-toggle-btn i { font-size: 14px; }

        @media (max-width: 768px) {
            /* Remove the View Items control and disable collapsing */
            .order-toggle-row { display: none !important; }
            .order-summary.is-collapsed { max-height: none !important; overflow: visible !important; padding: 0; margin: 0; border: none; }

            /* Make the Order Summary title minimal and without icon */
            #summarySection .section-title i { display: none; }
            #summarySection .section-title { gap: 8px; padding-bottom: 6px; margin-bottom: 8px; font-size: 22px; }

            /* Summary section and list: single card container with items inside */
            #summarySection.checkout-section { background: transparent; border: none; box-shadow: none; padding: 10px 0 0 0; }
            .order-header { background: transparent; border: none; box-shadow: none; padding: 0 2px; margin: 0 4px 8px 4px; /* widen */ }
            .order-summary {
                background: rgba(255, 255, 255, 0.75);
                border: none;
                border-radius: 16px;
                padding: 6px;
                margin: 0 4px; /* widen */
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
            }

            /* Items are simple rows separated by a divider inside the single card */
            .order-item {
                display: flex;
                align-items: center;
                gap: 12px;
                width: 100%;
                padding: 12px 10px;
                margin: 0;
                background: transparent;
                border: none;
                border-radius: 0;
                box-shadow: none;
                border-bottom: none; /* remove grey divider line on mobile */
                text-align: left;
                transition: none;
            }

            .order-item-image {
                width: 64px;
                height: 64px;
                border-radius: 12px;
                padding: 0;
                background: rgba(255, 255, 255, 0.6);
            }

            .order-item-title { font-size: 14px; margin: 0 0 6px 0; font-weight: 700; letter-spacing: 0.2px; }
            .order-item-meta {
                font-size: 12px;
                color: rgba(22, 105, 122, 0.7);
            }
            .order-item-specs { display: none; border-left: none !important; padding-left: 0 !important; }
            .order-item-price { font-size: 16px; margin-left: auto; color: var(--primary-color); font-weight: 800; }

            /* Totals as a separate glass card */
            .total-section {
                margin: 12px 4px 8px 4px; /* widen */
                background: #ffffff;
                border: none;
                border-radius: 12px;
                box-shadow: none;
                padding: 14px 16px;
            }
            .total-final { border-top: none; background: transparent; }
        }
    </style>
    <!-- Global Header Component -->
    <script src="global-header.js"></script>
</head>
<body>
    <!-- GlobalWebsiteHeader Component Container -->
    <div id="global-header-container"></div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            GlobalWebsiteHeader.init();
        });
    </script>

    <div class="checkout-container">
        <!-- Progress Indicator -->
        <div class="checkout-progress" style="grid-column: 1 / -1;">
            <div class="progress-steps">
                <div class="progress-step completed">
                    <div class="step-circle">âœ“</div>
                    <span>Cart</span>
                </div>
                <div class="step-connector"></div>
                <div class="progress-step active">
                    <div class="step-circle">2</div>
                    <span>Checkout</span>
                </div>
                <div class="step-connector"></div>
                <div class="progress-step">
                    <div class="step-circle">3</div>
                    <span>Confirmation</span>
                </div>
            </div>
        </div>

    <!-- Customer Information Section -->
    <div class="checkout-section" id="customerSection">
            <h2 class="section-title">
                <i class="fas fa-user"></i>
                Customer Information
            </h2>

            <!-- Required Fields Note -->
            <div class="required-note">
                Fields marked with an asterisk are required
            </div>

            <form id="checkoutForm">
                <div class="form-row">
                    <div class="form-group required half-width">
                        <label for="customerName">Full Name</label>
                        <input type="text" id="customerName" name="customerName" required autocomplete="name" inputmode="text" aria-required="true">
                        <div class="form-help-text">Enter your complete name as it should appear on the order</div>
                    </div>

                    <div class="form-group required half-width">
                        <label for="customerEmail">Email Address</label>
                        <input type="email" id="customerEmail" name="customerEmail" required autocomplete="email" inputmode="email" aria-required="true">
                        <div class="form-help-text">We'll send order updates to this email</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group required half-width">
                        <label for="customerPhone">Phone Number</label>
                        <div class="phone-input-container">
                            <span class="phone-prefix">+91</span>
                            <input type="tel" id="customerPhone" name="customerPhone" required placeholder="XXXXXXXXXX" pattern="^[0-9]{10}$" maxlength="10" oninput="formatPhoneNumberNew(this)" onfocus="handlePhoneFocusNew(this)" onblur="handlePhoneBlurNew(this)" autocomplete="tel" inputmode="numeric" aria-required="true">
                        </div>
                        <div id="phoneVerifySection" style="display: none; margin-top: 10px;">
                            <button type="button" id="verifyPhoneBtn" style="width: 100%; padding: 12px; border-radius: 8px; background: var(--primary-color); color: white; border: none; cursor: pointer; font-weight: 600; font-size: 14px;">
                                <i class="fas fa-shield-alt" style="margin-right: 8px;"></i>Verify Phone Number
                            </button>
                        </div>
                        <div id="otpContainer" style="display: none; margin-top: 10px;">
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="otpInput" placeholder="Enter 6-digit OTP" maxlength="6" inputmode="numeric" style="flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; text-align: center; letter-spacing: 3px;">
                                <button type="button" id="confirmOtpBtn" style="padding: 12px 20px; border-radius: 8px; background: #28a745; color: white; border: none; cursor: pointer; font-weight: 600;">Confirm</button>
                            </div>
                            <div id="otpMessage" style="font-size: 12px; margin-top: 8px;"></div>
                        </div>
                        <div id="phoneVerifiedIndicator" style="display: none; margin-top: 8px; padding: 8px 12px; background: #d4edda; border-radius: 8px; color: #155724;">
                            <i class="fas fa-check-circle" style="margin-right: 8px;"></i>Phone number verified
                        </div>
                        <div class="form-help-text">Enter 10-digit mobile number (Indian format)</div>
                    </div>

                    <div class="form-group half-width">
                        <label for="alternatePhone">Alternate Phone (Optional)</label>
                        <div class="phone-input-container">
                            <span class="phone-prefix">+91</span>
                            <input type="tel" id="alternatePhone" name="alternatePhone" placeholder="XXXXXXXXXX" pattern="^[0-9]{10}$" maxlength="10" oninput="formatPhoneNumberNew(this)" onfocus="handlePhoneFocusNew(this)" onblur="handlePhoneBlurNew(this)" autocomplete="tel" inputmode="numeric">
                        </div>
                        <div class="form-help-text">Backup contact number (Indian format)</div>
                    </div>
                </div>

                <!-- Address Fields -->
                <div class="form-group">
                    <label for="customerPincode">Pincode (Optional)</label>
                    <input type="text" id="customerPincode" name="customerPincode" placeholder="Enter 6-digit pincode for auto-fill" pattern="[0-9]{6}" maxlength="6" oninput="handlePincodeInput(this.value)" inputmode="numeric" autocomplete="postal-code">
                    <div class="form-help-text">Enter pincode to auto-fill city and state, or fill manually below</div>
                    <div id="pincodeLoader" class="pincode-loader" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i> Fetching location...
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group required half-width">
                        <label for="customerState">State</label>
                        <div class="autocomplete-container">
                            <input type="text" id="customerState" name="customerState" required placeholder="Start typing state name..." oninput="handleStateInput(this.value)" onblur="hideStateSuggestions()" onfocus="showStateSuggestions()" autocomplete="address-level1" inputmode="text" aria-autocomplete="list" aria-controls="stateSuggestions" aria-expanded="false">
                            <div id="stateSuggestions" class="autocomplete-suggestions" style="display: none;"></div>
                        </div>
                        <div class="form-help-text">Type to search and select your state</div>
                    </div>

                    <div class="form-group required half-width">
                        <label for="customerCity">City</label>
                        <div class="autocomplete-container">
                            <input type="text" id="customerCity" name="customerCity" required placeholder="Start typing city name..." oninput="handleCityInput(this.value)" onblur="hideCitySuggestions()" onfocus="showCitySuggestions()" autocomplete="address-level2" inputmode="text" aria-autocomplete="list" aria-controls="citySuggestions" aria-expanded="false">
                            <div id="citySuggestions" class="autocomplete-suggestions" style="display: none;"></div>
                        </div>
                        <div class="form-help-text">Type to search and select your city</div>
                    </div>
                </div>

                <div class="form-group required">
                    <label for="customerAddress">House/Flat No. & Street Address</label>
                    <textarea id="customerAddress" name="customerAddress" rows="2" required placeholder="House/Flat Number, Building Name, Street Name" autocomplete="address-line1" aria-required="true"></textarea>
                    <div class="form-help-text">Enter your complete house/flat number and street address</div>
                </div>

                <div class="form-group">
                    <label for="customerLandmark">Landmark (Optional)</label>
                    <input type="text" id="customerLandmark" name="customerLandmark" placeholder="Near school, mall, etc." autocomplete="address-line2">
                    <div class="form-help-text">Nearby landmark for easy location</div>
                </div>

                <div class="form-group">
                    <div class="delivery-estimate" id="deliveryEstimate">
                        <i class="fas fa-truck"></i>
                        <strong>Estimated Delivery:</strong> <span id="estimatedDate"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="specialInstructions">Special Instructions (Optional)</label>
                    <textarea id="specialInstructions" name="specialInstructions" rows="3" placeholder="Any special requirements, delivery preferences, or notes for your order"></textarea>
                    <div class="form-help-text">Let us know if you have any specific requirements</div>
                </div>
            </form>

            <!-- Security Indicators -->
            <div class="security-indicators">
                <div class="security-item">
                    <i class="fas fa-shield-alt"></i>
                    <span>Secure Checkout</span>
                </div>
                <div class="security-item">
                    <i class="fas fa-lock"></i>
                    <span>Data Protected</span>
                </div>
                <div class="security-item">
                    <i class="fas fa-award"></i>
                    <span>Quality Guaranteed</span>
                </div>
            </div>
        </div>

    <!-- Order Summary Section -->
    <div class="checkout-section" id="summarySection">
            <div class="order-header">
                <h2 class="section-title">
                    <i class="fas fa-receipt"></i>
                    Order Summary
                </h2>
                <div class="order-count" id="orderCount">0 items</div>
            </div>

            <!-- Mobile: toggle to show/hide items -->
            <div class="order-toggle-row">
                <button type="button" class="order-toggle-btn" id="orderToggleBtn">
                    <i class="fas fa-list"></i>
                    <span id="orderToggleText">View items</span>
                    <span id="orderToggleCount" style="opacity:0.8;">(0)</span>
                </button>
            </div>

            <div class="order-summary" id="orderSummary">
                <!-- Order items will be populated here -->
            </div>

            <!-- Promo Code Section -->
            <div class="promo-code-section">
                <label for="promoCode"><i class="fas fa-tag"></i> Have a promo code?</label>
                <div class="promo-code-input">
                    <input type="text" id="promoCode" placeholder="Enter promo code">
                    <button type="button" onclick="applyPromoCode()">Apply</button>
                </div>
            </div>

            <div class="total-section">
                <div class="total-row">
                    <span>Subtotal:</span>
                    <span id="subtotal">â‚¹0</span>
                </div>
                <div class="total-row">
                    <span>Delivery:</span>
                    <span id="deliveryCharge">â‚¹50</span>
                </div>
                <div class="total-row" id="discountRow" style="display: none;">
                    <span>Discount:</span>
                    <span id="discountAmount" style="color: var(--success-color);">-â‚¹0</span>
                </div>
                <div class="total-row total-final">
                    <span>Total:</span>
                    <span id="finalTotal">â‚¹0</span>
                </div>
            </div>

            <button class="place-order-btn" id="placeOrderBtn" onclick="placeOrder()">
                <i class="fas fa-check-circle"></i>
                Place Order
            </button>

            <!-- Additional Information -->
            <div style="margin-top: 20px; text-align: center; color: var(--text-secondary); font-size: 14px;">
                <p><i class="fas fa-info-circle"></i> Your order will be processed within 24 hours</p>
                <p><i class="fas fa-phone"></i> Need help? Call us at <strong>+91-XXXXX-XXXXX</strong></p>
            </div>
        </div>
    </div>

    <!-- Processing Overlay -->
    <div class="processing-overlay" id="processingOverlay">
        <div class="processing-content">
            <!-- Processing State -->
            <div class="processing-state" id="processingState">
                <div class="processing-spinner">
                    <i class="fas fa-spinner"></i>
                </div>
                <h3>Processing Your Order<span class="loading-dots"></span></h3>
                <p>Please wait while we prepare your order details.</p>
            </div>
            <!-- Success State -->
            <div class="success-state" id="successState" style="display: none;">
                <div class="success-checkmark">
                    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                        <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                        <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                    </svg>
                </div>
                <h3>Order Confirmed!</h3>
                <p>Redirecting you to order details...</p>
            </div>
        </div>
    </div>

    <!-- Mobile sticky checkout bar -->
    <div class="mobile-sticky-bar" id="mobileStickyBar" aria-hidden="false" style="padding-bottom: calc(12px + env(safe-area-inset-bottom));">
        <div class="mobile-sticky-content" role="region" aria-label="Checkout summary and place order">
            <button type="button" class="mobile-items-toggle" id="mobileItemsToggle" aria-expanded="false" aria-controls="mobileOrderDrawer">
                <i class="fas fa-chevron-up" aria-hidden="true"></i>
                <span class="sr-only">View items</span>
            </button>
            <div class="mobile-total-box" id="mobileTotalBox" role="button" tabindex="0" aria-label="Tap to view your items">
                <div class="mobile-total-label">Total payable</div>
                <div class="mobile-total-value" id="mobileFinalTotal">â‚¹0</div>
                <div class="mobile-items-count" id="mobileItemCount">0 items</div>
            </div>
            <button type="button" class="mobile-place-order-btn" id="mobilePlaceOrderBtn" onclick="placeOrder()" aria-disabled="false">
                <i class="fas fa-lock"></i>
                Place Order
            </button>
        </div>
    </div>

    <!-- Mobile bottom drawer for order items -->
    <div class="mobile-order-drawer" id="mobileOrderDrawer" aria-hidden="true">
        <div class="mobile-drawer-swipe-handle" id="mobileDrawerSwipeHandle" aria-label="Drag to close"></div>
        <div class="mobile-drawer-header">
            <span>Your items</span>
            <button type="button" class="mobile-drawer-close" id="mobileDrawerClose" aria-label="Close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="mobile-drawer-content" id="mobileOrderList">
            <!-- Items will be injected here -->
        </div>
    </div>
    <div class="mobile-drawer-backdrop" id="mobileDrawerBackdrop" aria-hidden="true"></div>

    <!-- Razorpay Integration Scripts -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <link rel="stylesheet" href="razorpay-styles.css">
    <!-- Removed broken razorpay-config.js - using simple direct payment instead -->
    
    <!-- Cloudinary Direct Upload Integration -->
    <script src="cloudinary-direct.js?v=2.1-indexeddb"></script>
    <script src="checkout-direct.js"></script>
    
    <!-- Cloudinary Integration (legacy - keeping for fallback) -->
    <script src="cloudinary-config.js"></script>
    
    <!-- Firebase Backend Integration -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="fast2sms-client.js?v=5.0.1208"></script>
    
    <!-- Initialize Fast2SMS OTP Client BEFORE loading otp-auth-realsms.js -->
    <script>
        // Initialize Fast2SMS OTP Client immediately (not waiting for DOMContentLoaded)
        try {
            console.log('ðŸ”§ Initializing Fast2SMS OTP Client for checkout...');
            // No URL parameter - uses production Netlify functions by default
            window.otpClient = new Fast2SMSOTPClient();
            console.log('âœ… Fast2SMS OTP Client initialized successfully');
            console.log('ðŸ“¡ API Endpoint:', window.otpClient.apiBaseURL);
        } catch (error) {
            console.error('âŒ Failed to initialize Fast2SMS client:', error);
        }
    </script>
    
    <script src="otp-auth-realsms.js?v=5.0.1208"></script>
    <script type="module" src="firebase-client-new.js?v=5.0.1208"></script>
    
    <!-- Authentication Check Script -->
    <script>
        function setProfileDropdownState(isOpen) {
            const dropdownContainer = document.getElementById('profileDropdown');
            const dropdownMenu = document.getElementById('profileDropdownMenu');
            const profileBtn = document.getElementById('profileBtn');

            if (!dropdownContainer || !dropdownMenu || !profileBtn) {
                return;
            }

            dropdownContainer.classList.toggle('open', isOpen);
            profileBtn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
            dropdownMenu.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
        }

        function toggleProfileDropdown() {
            const dropdownContainer = document.getElementById('profileDropdown');
            if (!dropdownContainer) {
                return;
            }

            const isOpen = dropdownContainer.classList.contains('open');
            setProfileDropdownState(!isOpen);
        }

        function setupProfileDropdown() {
            const dropdownContainer = document.getElementById('profileDropdown');
            const dropdownMenu = document.getElementById('profileDropdownMenu');
            const profileBtn = document.getElementById('profileBtn');

            if (!dropdownContainer || !dropdownMenu || !profileBtn || dropdownContainer.dataset.dropdownInit === 'true') {
                return;
            }

            dropdownContainer.dataset.dropdownInit = 'true';

            profileBtn.setAttribute('aria-haspopup', 'true');
            profileBtn.setAttribute('aria-expanded', 'false');
            dropdownMenu.setAttribute('role', 'menu');
            dropdownMenu.setAttribute('aria-hidden', 'true');

            profileBtn.addEventListener('click', function(event) {
                event.preventDefault();
                event.stopPropagation();
                toggleProfileDropdown();
            });

            dropdownMenu.addEventListener('click', function(event) {
                const actionableItem = event.target.closest('a, button');
                if (actionableItem && actionableItem.dataset.closeDropdown === 'true') {
                    setProfileDropdownState(false);
                }
            });

            setProfileDropdownState(false);
        }

        document.addEventListener('DOMContentLoaded', async function() {
            setupProfileDropdown();

            // Check authentication status
            await checkAuthStatus();
        });

        // Get current authenticated user from Firebase
        async function getCurrentAuthenticatedUser() {
            try {
                // Wait for Firebase to be ready with retry mechanism
                const maxRetries = 5; // Reduced from 10 since we now have the proper scripts
                for (let i = 0; i < maxRetries; i++) {
                    if (typeof window.otpAuth !== 'undefined') {
                        console.log('ðŸ“± Getting current user from Firebase...');
                        const user = await window.otpAuth.getCurrentUser();
                        console.log('ðŸ“± Firebase user result:', user);
                        return user;
                    } else {
                        console.log(`â³ Firebase not ready yet, retrying... (${i + 1}/${maxRetries})`);
                        await new Promise(resolve => setTimeout(resolve, 300)); // Reduced from 500ms
                    }
                }
                
                console.log('âŒ OTP Auth system not available after retries, falling back to localStorage');
                // Fallback to localStorage if Firebase is not available after retries
                const userDataStr = localStorage.getItem('jb_current_user');
                if (!userDataStr) return null;
                
                try {
                    return JSON.parse(userDataStr);
                } catch (parseError) {
                    console.log('Failed to parse user data as JSON, might be old format:', userDataStr);
                    if (userDataStr.startsWith('+91') || userDataStr.startsWith('+')) {
                        return { phone: userDataStr, name: 'User' };
                    }
                    return null;
                }
            } catch (error) {
                console.error('âŒ Error getting current user from Firebase:', error);
                return null;
            }
        }

        // Check if user is authenticated and update UI accordingly
        async function checkAuthStatus() {
            try {
                const user = await getCurrentAuthenticatedUser();
                console.log('ðŸ“± checkAuthStatus - user found:', user);
                
                const guestOptions = document.getElementById('guestOptions');
                const authenticatedOptions = document.getElementById('authenticatedOptions');
                
                if (user && user.phone) {
                    console.log('ðŸ“± checkAuthStatus - user name:', user.name);
                    console.log('ðŸ“± checkAuthStatus - user phone:', user.phone);
                    
                    // User is logged in
                    if (guestOptions) guestOptions.style.display = 'none';
                    if (authenticatedOptions) authenticatedOptions.style.display = 'block';
                    
                    // Update user info in dropdown
                    const dropdownUserName = document.getElementById('dropdownUserName');
                    const dropdownUserPhone = document.getElementById('dropdownUserPhone');
                    
                    if (dropdownUserName) {
                        dropdownUserName.textContent = user.name || 'User';
                        console.log('ðŸ“± checkAuthStatus - Set dropdown name to:', user.name || 'User');
                    }
                    if (dropdownUserPhone) {
                        dropdownUserPhone.textContent = user.phone || 'Phone not available';
                    }
                } else {
                    showGuestState();
                }
                
                // Also call updateAuthUI for consistency with homepage
                await updateAuthUI();
            } catch (error) {
                console.log('Auth check error:', error);
                showGuestState();
            }
        }

        function showGuestState() {
            // Default to guest state
            const guestOptions = document.getElementById('guestOptions');
            const authenticatedOptions = document.getElementById('authenticatedOptions');
            if (guestOptions) guestOptions.style.display = 'block';
            if (authenticatedOptions) authenticatedOptions.style.display = 'none';
        }

        // Update authentication UI based on login status
        async function updateAuthUI() {
            try {
                const user = await getCurrentAuthenticatedUser();
                console.log('ðŸ“± updateAuthUI - user found:', user);
                
                const guestOptions = document.getElementById('guestOptions');
                const authenticatedOptions = document.getElementById('authenticatedOptions');
                const profileBtn = document.getElementById('profileBtn');
                
                if (user) {
                    console.log('ðŸ“± updateAuthUI - user name:', user.name);
                    console.log('ðŸ“± updateAuthUI - user phone:', user.phone);
                    
                    // User is logged in - show authenticated options, hide guest options
                    if (guestOptions) {
                        guestOptions.style.display = 'none';
                    }
                    if (authenticatedOptions) {
                        authenticatedOptions.style.display = 'block';
                    }
                    
                    // Update user info in dropdown
                    const dropdownUserName = document.getElementById('dropdownUserName');
                    const dropdownUserPhone = document.getElementById('dropdownUserPhone');
                    
                    if (dropdownUserName) {
                        dropdownUserName.textContent = user.name || 'User';
                        console.log('ðŸ“± updateAuthUI - Set dropdown name to:', user.name || 'User');
                    }
                    if (dropdownUserPhone) {
                        dropdownUserPhone.textContent = user.phone || 'Phone not available';
                    }
                    
                    // Always keep profile button text as "Profile"
                    if (profileBtn) {
                        profileBtn.innerHTML = `
                            <i class="fas fa-user-alt"></i>
                            <span class="button-label">Profile</span>
                        `;
                        profileBtn.style.color = '#16697A';
                    }
                } else {
                    // User is not logged in - show guest options, hide authenticated options
                    if (guestOptions) {
                        guestOptions.style.display = 'block';
                    }
                    if (authenticatedOptions) {
                        authenticatedOptions.style.display = 'none';
                    }
                    
                    // Reset profile button to default
                    if (profileBtn) {
                        profileBtn.innerHTML = `
                            <i class="fas fa-user-alt"></i>
                            <span class="button-label">Profile</span>
                        `;
                    }
                }
            } catch (error) {
                console.error('âŒ Error updating auth UI:', error);
            }
        }

        // View user profile / toggle dropdown
        async function viewProfile() {
            window.location.href = 'my-profile.html';
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdownContainer = document.getElementById('profileDropdown');
            if (!dropdownContainer) {
                return;
            }

            if (!dropdownContainer.contains(event.target)) {
                setProfileDropdownState(false);
            }
        });

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                setProfileDropdownState(false);
            }
        });

        // View user orders
        function viewOrders() {
            window.location.href = 'my-orders.html';
        }

        // Sign out function
        function signOut() {
            if (confirm('Are you sure you want to sign out?')) {
                localStorage.removeItem('jb_current_user');
                localStorage.removeItem('jb_users');
                window.location.reload();
            }
        }

        // Contact and About functions
        function contactUs() {
            alert('Contact Us\n\nEmail: contact@jbcreations.com\nPhone: +91 12345 67890\nAddress: 123 Art Street, Creative City, India\n\nWe\'d love to hear from you!');
        }

        function aboutUs() {
            alert('About Xidlz\n\nWe are passionate about turning your precious memories into beautiful wall art. With years of experience in custom photo framing, we use premium materials and professional craftsmanship to create frames that last a lifetime.\n\nOur mission is to help you showcase your most cherished moments in style.');
        }
    </script>

    <!-- Firebase SDK - already loaded above, removing duplicates -->
    <!-- Authentication utilities - Demo OTP (fallback) -->
    <script src="otp-auth.js?v=5.0.1208"></script>
    <script src="auth.js?v=5.0.1208"></script>
    
    <!-- Cache-busted checkout script to ensure latest version loads -->
    <script src="checkout.js?v=9.4-otp-fix"></script>
</body>
</html>
