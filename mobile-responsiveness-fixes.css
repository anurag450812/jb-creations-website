/*
 * Mobile Performance CSS Optimizations
 * Specific performance improvements for mobile browsers
 */

/* Mobile-specific performance optimizations */
@media screen and (max-width: 768px) {
    
    /* 1. Enable hardware acceleration for key elements */
    .preview-section,
    .frame-preview,
    .frame-aspect-wrapper,
    #frame,
    #previewImage,
    .mobile-dropup,
    .mobile-bottom-bar {
        will-change: transform;
        transform: translateZ(0); /* Force hardware acceleration */
        backface-visibility: hidden;
    }
    
    /* 2. Optimize animations for mobile */
    .frame-transitioning,
    .frame-wrapper-transitioning,
    .frame-morphing {
        will-change: transform, opacity;
        animation-fill-mode: both;
        animation-play-state: running;
    }
    
    /* 3. Reduce animation complexity on mobile */
    @keyframes frameResize {
        0% {
            transform: translate3d(0, 0, 0) scale(1);
        }
        50% {
            transform: translate3d(0, 0, 0) scale(0.98);
        }
        100% {
            transform: translate3d(0, 0, 0) scale(1);
        }
    }
    
    @keyframes frameFadeInOut {
        0% {
            opacity: 1;
            transform: translate3d(0, 0, 0);
        }
        50% {
            opacity: 0.95;
            transform: translate3d(0, -2px, 0);
        }
        100% {
            opacity: 1;
            transform: translate3d(0, 0, 0);
        }
    }
    
    @keyframes smoothMorphing {
        0% {
            transform: translate3d(0, 0, 0) scale(1);
        }
        50% {
            transform: translate3d(0, 0, 0) scale(0.99);
        }
        100% {
            transform: translate3d(0, 0, 0) scale(1);
        }
    }
    
    /* 4. Optimize hover states for touch devices */
    button:hover,
    .nav-btn:hover,
    .step-dot:hover {
        transform: none; /* Disable hover transforms on mobile */
    }
    
    /* 5. Add touch-specific feedback */
    .touch-active {
        transform: scale(0.95) !important;
        transition: transform 0.1s ease-out !important;
    }
    
    /* 6. Optimize scrolling performance */
    .container,
    .preview-section,
    .customization-section,
    .upload-section {
        -webkit-overflow-scrolling: touch;
        scroll-behavior: auto; /* Disable smooth scrolling on mobile */
    }
    
    /* 7. Reduce box-shadow complexity */
    .preview-section,
    .card,
    button,
    .upload-card {
        box-shadow: 0 2px 8px rgba(22, 105, 122, 0.1) !important;
    }
    
    /* 8. Optimize background attachments */
    body,
    .container {
        background-attachment: scroll !important; /* Fixed backgrounds are slow on mobile */
    }
    
    /* 9. Simplify transitions */
    * {
        transition-duration: 0.2s !important;
        transition-timing-function: ease-out !important;
    }
    
    /* 10. Optimize image rendering */
    img {
        image-rendering: -webkit-optimize-contrast;
        image-rendering: optimizeSpeed;
        transform: translateZ(0); /* Hardware acceleration */
    }
    
    /* 11. Prevent layout thrashing */
    .frame-preview,
    .frame-aspect-wrapper {
        contain: layout style paint;
    }
    
    /* 12. Optimize filter effects for mobile */
    #previewImage {
        will-change: filter;
        backface-visibility: hidden;
    }
    
    /* 13. Reduce motion for users who prefer it */
    @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
            scroll-behavior: auto !important;
        }
    }
    
    /* 14. Battery-aware optimizations */
    .low-battery-mode * {
        animation: none !important;
        transition: none !important;
        transform: none !important;
        filter: none !important;
    }
    
    .low-battery-mode .frame-transitioning,
    .low-battery-mode .frame-wrapper-transitioning,
    .low-battery-mode .frame-morphing {
        animation: none !important;
    }
    
    /* 15. Connection-aware optimizations for slow networks */
    @media (max-width: 480px) {
        /* Further reduce complexity on very small screens */
        .frame-transitioning,
        .frame-wrapper-transitioning,
        .frame-morphing {
            animation-duration: 0.15s !important;
        }
        
        /* Simplify box-shadows even more */
        .preview-section,
        .card,
        button {
            box-shadow: 0 1px 4px rgba(22, 105, 122, 0.08) !important;
        }
    }
}

/* 16. Optimize for high-DPI mobile displays */
@media screen and (max-width: 768px) and (-webkit-min-device-pixel-ratio: 2) {
    /* Use CSS transforms instead of expensive operations */
    .frame-preview {
        transform: translate3d(0, 0, 0) scale(1);
    }
    
    /* Optimize text rendering */
    body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeSpeed;
    }
}

/* 17. Memory-conscious styles */
@media screen and (max-width: 768px) {
    /* Avoid creating too many paint layers */
    .container > * {
        isolation: auto;
    }
    
    /* Limit the number of elements that create stacking contexts */
    .preview-section,
    .mobile-dropup {
        z-index: auto;
    }
    
    /* Only promote essential elements to their own layers */
    .mobile-bottom-bar,
    .mobile-dropup.open {
        z-index: 1000;
        isolation: isolate;
    }
}

/* 18. Touch-optimized input styles */
@media screen and (max-width: 768px) {
    input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        height: 44px; /* Larger touch target */
        background: transparent;
    }
    
    input[type="range"]::-webkit-slider-thumb {
        width: 28px;
        height: 28px;
        margin-top: -10px;
        transform: translate3d(0, 0, 0); /* Hardware acceleration */
    }
    
    button,
    .mobile-size-btn,
    .mobile-color-btn,
    .mobile-texture-btn {
        min-height: 44px; /* iOS touch target recommendation */
        touch-action: manipulation; /* Prevent double-tap zoom */
    }
}

/* 19. Progressive enhancement for modern mobile browsers */
@supports (backdrop-filter: blur(10px)) {
    @media screen and (max-width: 768px) {
        .mobile-dropup {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
    }
}

/* 20. Optimize for mobile Safari specifically */
@supports (-webkit-touch-callout: none) {
    .preview-section,
    .frame-preview {
        -webkit-transform: translate3d(0, 0, 0);
        transform: translate3d(0, 0, 0);
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        -webkit-perspective: 1000px;
        perspective: 1000px;
    }
    
    /* Fix iOS Safari scrolling issues */
    .container {
        -webkit-overflow-scrolling: touch;
        overflow-x: hidden;
    }
}
